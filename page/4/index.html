<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="KJH">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%BF%AA%E7%A7%91%E6%96%AF%E5%BD%BB%E7%AE%97%E6%B3%95(Dijkstra)%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%BF%AA%E7%A7%91%E6%96%AF%E5%BD%BB%E7%AE%97%E6%B3%95(Dijkstra)%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">数据结构迪科斯彻算法(Dijkstra)算法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-29 21:40:46" itemprop="dateCreated datePublished" datetime="2020-12-29T21:40:46+08:00">2020-12-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9B%BE%E7%9A%84%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2%E5%92%8C%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9B%BE%E7%9A%84%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2%E5%92%8C%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2/" class="post-title-link" itemprop="url">数据结构图的深度优先搜索和广度优先搜索</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-29 21:40:26" itemprop="dateCreated datePublished" datetime="2020-12-29T21:40:26+08:00">2020-12-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9B%BE%E7%9A%84%E9%82%BB%E6%8E%A5%E7%9F%A9%E9%98%B5%E5%AD%98%E5%82%A8%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9B%BE%E7%9A%84%E9%82%BB%E6%8E%A5%E7%9F%A9%E9%98%B5%E5%AD%98%E5%82%A8%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">数据结构BFS、DFS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-12-29 21:38:30 / 修改时间：21:41:36" itemprop="dateCreated datePublished" datetime="2020-12-29T21:38:30+08:00">2020-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>图的邻接表存储实现：<a href="http://blog.csdn.net/wenqian1991/article/details/24667287" target="_blank" rel="noopener">http://blog.csdn.net/wenqian1991/article/details/24667287</a></p>
<p>图的邻接表DFS和BFS算法：<a href="http://blog.csdn.net/wenqian1991/article/details/24812393" target="_blank" rel="noopener">http://blog.csdn.net/wenqian1991/article/details/24812393</a></p>
<p>这里则介绍图的另外一种存储方式：邻接矩阵。参考资料《大话数据结构》《C算法：卷二》</p>
<p>一、图的数据结构</p>
<p>图的邻接矩阵存储方式是用两个数据来表示。一个一维数组存储图中顶点信息，一个二维数组（称为邻接矩阵）存储图中的边的信息。</p>
<p>见下图：（图片来源于《大话数据结构》）</p>
<p>​         <img src="/2020/12/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9B%BE%E7%9A%84%E9%82%BB%E6%8E%A5%E7%9F%A9%E9%98%B5%E5%AD%98%E5%82%A8%E5%AE%9E%E7%8E%B0/20150731211453086" alt="img"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*图的邻接矩阵存储*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> VertexType;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> EdgeType;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXVEX 100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INFI 65535</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	VertexType vexs[MAXVEX];           <span class="comment">/*顶点表*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	EdgeType matrix[MAXVEX][MAXVEX];   <span class="comment">/*邻接矩阵*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> numVertexes;          <span class="comment">/*顶点数*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> numEdges;             <span class="comment">/*边数*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;Graph;</span><br></pre></td></tr></table></figure>

<p>二、创建一个图</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建一个邻接矩阵无向图*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">Graph* <span class="title">CreateGraph</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	Graph *pGragh = <span class="keyword">new</span> Graph;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == pGragh)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"输入顶点数和边数："</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; pGragh-&gt;numVertexes &gt;&gt; pGragh-&gt;numEdges;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pGragh-&gt;numVertexes; ++i)<span class="comment">/*建立顶点表*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		(pGragh-&gt;vexs)[i] = i;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pGragh-&gt;numVertexes; ++i)<span class="comment">/*邻接矩阵初始化*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; pGragh-&gt;numVertexes; ++j)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			(pGragh-&gt;matrix)[i][j] = INFI;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (i == j)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				(pGragh-&gt;matrix)[i][j] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; pGragh-&gt;numEdges; ++k)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> i, j, w;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边(vi,vj)上的下标i，下标j和权重w："</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; i &gt;&gt; j &gt;&gt; w;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		(pGragh-&gt;matrix)[i][j] = w;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		(pGragh-&gt;matrix)[j][i] = (pGragh-&gt;matrix)[i][j];<span class="comment">//无向图是对称矩阵</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> pGragh;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*创建一个邻接矩阵有向图*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">Graph* <span class="title">CreateDiGraph</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	Graph *pGragh = <span class="keyword">new</span> Graph;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == pGragh)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"输入顶点数和边数："</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; pGragh-&gt;numVertexes &gt;&gt; pGragh-&gt;numEdges;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pGragh-&gt;numVertexes; ++i)<span class="comment">/*建立顶点表*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		(pGragh-&gt;vexs)[i] = i;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pGragh-&gt;numVertexes; ++i)<span class="comment">/*邻接矩阵初始化*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; pGragh-&gt;numVertexes; ++j)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			(pGragh-&gt;matrix)[i][j] = INFI;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (i == j)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				(pGragh-&gt;matrix)[i][j] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; pGragh-&gt;numEdges; ++k)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> i, j, w;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"输入边&lt;vi,vj&gt;上的下标i，下标j和权重w："</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; i &gt;&gt; j &gt;&gt; w;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		(pGragh-&gt;matrix)[i][j] = w;<span class="comment">//清楚上面输入的顺序，有向边的开始点和终点</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> pGragh;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三、检查图中两个顶点间是否有边</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*检查两个顶点之间是否有边</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">对于邻接矩阵存储图，这比较简单。其中有向图对输入顶点顺序有要求*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">GraphHasEdge</span><span class="params">(Graph *pGraph, <span class="keyword">unsigned</span> <span class="keyword">int</span> begin, <span class="keyword">unsigned</span> <span class="keyword">int</span> end)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == pGraph || begin &gt;= pGraph-&gt;numVertexes || end &gt;= pGraph-&gt;numVertexes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (begin == end)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ((pGraph-&gt;matrix)[begin][end] != INFI) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>四、DFS</p>
<p>关于DFS与BFS的介绍见开篇链接</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*DFS*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*邻接矩阵的深度优先递归算法*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFSUtil</span><span class="params">(Graph *pGraph, <span class="keyword">int</span> start, <span class="keyword">bool</span> visited[])</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	visited[start] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; start &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; pGraph-&gt;numVertexes; ++j)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ((pGraph-&gt;matrix)[start][j] != <span class="number">0</span> &amp;&amp; (pGraph-&gt;matrix)[start][j] != INFI &amp;&amp; !visited[j])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			DFSUtil(pGraph, j, visited);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*邻接矩阵的深度优先搜索*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(Graph *pGraph)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == pGraph)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> *visited = <span class="keyword">new</span> <span class="keyword">bool</span>[pGraph-&gt;numVertexes];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(visited, <span class="literal">false</span>, pGraph-&gt;numVertexes);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pGraph-&gt;numVertexes; ++i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!visited[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			DFSUtil(pGraph, i, visited);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">delete</span>[] visited;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>五、BFS </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*BFS*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">(Graph *pGraph)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == pGraph)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> *visited = <span class="keyword">new</span> <span class="keyword">bool</span>[pGraph-&gt;numVertexes];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(visited, <span class="literal">false</span>, pGraph-&gt;numVertexes);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; <span class="built_in">queue</span>;<span class="comment">//利用链表构造一个队列</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pGraph-&gt;numVertexes; ++i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!visited[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			visited[i] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; pGraph-&gt;vexs[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="built_in">queue</span>.push_back(i);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">while</span> (!<span class="built_in">queue</span>.empty())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				i = *<span class="built_in">queue</span>.begin();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="built_in">queue</span>.pop_front();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; pGraph-&gt;numVertexes; ++j)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">					<span class="keyword">if</span> ((pGraph-&gt;matrix)[i][j] != <span class="number">0</span> &amp;&amp; (pGraph-&gt;matrix)[i][j] != INFI &amp;&amp; !visited[j])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">					&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">						visited[j] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">						<span class="built_in">cout</span> &lt;&lt; pGraph-&gt;vexs[j] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">						<span class="built_in">queue</span>.push_back(j);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里只提供相关代码实现，代码已测试，理论部分请参考相关资料。 </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/29/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E6%B1%87%E6%80%BB1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/29/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E6%B1%87%E6%80%BB1/" class="post-title-link" itemprop="url">汇编语言基础学习汇总1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-29 21:04:30" itemprop="dateCreated datePublished" datetime="2020-12-29T21:04:30+08:00">2020-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-01 22:20:21" itemprop="dateModified" datetime="2021-01-01T22:20:21+08:00">2021-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B1%87%E7%BC%96/" itemprop="url" rel="index"><span itemprop="name">汇编</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><h5 id="汇编语言指令组成"><a href="#汇编语言指令组成" class="headerlink" title="汇编语言指令组成"></a><strong>汇编语言指令组成</strong></h5><ul>
<li>汇编指令：机器码的助记符，有对应的机器码。</li>
<li>伪指令：没有对应的机器码，编译器执行，机器不执行。</li>
<li>其他符号：如±*/有编译器识别，无对应机器码。</li>
</ul>
<h5 id="CPU与外部器件交互需要"><a href="#CPU与外部器件交互需要" class="headerlink" title="CPU与外部器件交互需要"></a><strong>CPU与外部器件交互需要</strong></h5><ul>
<li>存储单元地址（地址信息）</li>
<li>器件选择，读写命令（控制信息）</li>
<li>数据（数据信息）</li>
</ul>
<h5 id="总线"><a href="#总线" class="headerlink" title="总线"></a><strong>总线</strong></h5><p>总线就是一根根导线的集合，分为</p>
<ul>
<li>地址总线，越宽（数量越多）代表可以寻址的范围越大</li>
<li>数据总线，越宽代表一次性读写的数据越多（8根1字节）</li>
<li>控制总线，越宽代表对器件控制操作越多</li>
</ul>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a><strong>小结</strong></h5><p>汇编指令和机器指令一一对应</p>
<p>每一种cpu都有自己的汇编指令集</p>
<p>在存储器中指令和数据都是二进制，没有任何区别</p>
<p>CPU可以直接使用的信息存放在存储器中（内存）</p>
<h5 id="接口卡"><a href="#接口卡" class="headerlink" title="接口卡"></a><strong>接口卡</strong></h5><p>CPU无法直接控制显示器，键盘等的外围设备，但CPU通过直接控制这些外围设备在主板上的接口卡来控制这些设备。</p>
<h5 id="存储器"><a href="#存储器" class="headerlink" title="存储器"></a><strong>存储器</strong></h5><p>随机存储器（RAM）：带电存储，关机丢失，可读可写</p>
<ul>
<li>用于存放CPU使用的绝大部分程序和数据，主随机存储器由装在主板上的RAM和扩展插槽的RAM组成。</li>
<li>其他接口卡上也可能有自己的RAM</li>
</ul>
<p>只读存储器（ROM）：关机不丢，只能读取</p>
<ul>
<li>主板上的ROM装有系统的BIOS（基本输入输出系统）。</li>
<li>其他接口卡上也可能有自己的ROM，一般装着相应的BIOS。</li>
</ul>
<p>（P10图）</p>
<h5 id="内存地址空间"><a href="#内存地址空间" class="headerlink" title="内存地址空间"></a><strong>内存地址空间</strong></h5><p>以上这些内存都和CPU总线相连，CPU都通过控制总线向他们发出内存读写命令。所以CPU都把他们当内存对待，看做一个一个由若干存储单元组成的逻辑存储器，即内存地址空间（一个假想的逻辑存储器P11图）。</p>
<p>内存地址空间中的各个不同的地址段代表不同的存储设备，内存地址空间大小收到CPU地址总线长度限制。</p>
<h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h3><h5 id="内部总线"><a href="#内部总线" class="headerlink" title="内部总线"></a><strong>内部总线</strong></h5><p>之前讨论的总线是CPU控制外部设备使用的总线，是将CPU和外部部件连接的。而CPU内部由寄存器，运算器，控制器等组成，由内部总线相连，内部总线负责连接CPU内部的部件。</p>
<h5 id="通用寄存器"><a href="#通用寄存器" class="headerlink" title="通用寄存器"></a><strong>通用寄存器</strong></h5><p>8086CPU寄存器都是16位的，一共14个，分别是AX,BX,CX,DX,SI,DI,SP,BP,IP,CS,SS,DS,ES,PSW。其中AX,BX,CX,DX四个寄存器通常存放一般性的数据，称为通用寄存器。</p>
<p>而且为了兼容上一代的8位寄存器，这四个寄存器可以拆开成两个8位的寄存器来使用。称为AH,AL,BH,BL,CH,CL,DH,DL。低八位（编号0-7）构成L寄存器，高八位构成H寄存器。</p>
<h5 id="字"><a href="#字" class="headerlink" title="字"></a><strong>字</strong></h5><p>8086CPU可以处理以下两种数据</p>
<ul>
<li>字节byte，8位</li>
<li>字word，连个字节，16位。分别称为高位字节和低位字节。</li>
</ul>
<h5 id="简单的汇编指令"><a href="#简单的汇编指令" class="headerlink" title="简单的汇编指令"></a><strong>简单的汇编指令</strong></h5><table>
<thead>
<tr>
<th>指令</th>
<th>操作</th>
<th>高级语言</th>
</tr>
</thead>
<tbody><tr>
<td>mov ax,18</td>
<td>将18存入AX寄存器</td>
<td>AX=18</td>
</tr>
<tr>
<td>add ax,8</td>
<td>将AX寄存器中的数加8</td>
<td>AX=AX+8</td>
</tr>
<tr>
<td>mov ax,bx</td>
<td>将BX中的数据存入AX</td>
<td>AX=BX</td>
</tr>
<tr>
<td>add ax,bx</td>
<td>将AX中的数据和BX中的数据相加存入AX</td>
<td>AX=AX+BX</td>
</tr>
</tbody></table>
<p>汇编指令或寄存器名称不区分大小写。</p>
<p>注：AX寄存器当做两个8位寄存器al和ah使用的时候，CPU就把他们当做两个8位寄存器使用，而不会看成是一个16未分开，即如果al进行加法运算C5+93=158，即add al,93，al会变成58，ax则是0058而不是0158。</p>
<h5 id="CPU位结构"><a href="#CPU位结构" class="headerlink" title="CPU位结构"></a><strong>CPU位结构</strong></h5><p>16位结构的CPU指的是运算器一次最多处理16位数据，寄存器宽度16，寄存器和运算器之间通路也是16位。</p>
<h5 id="CPU表示物理地址"><a href="#CPU表示物理地址" class="headerlink" title="CPU表示物理地址"></a><strong>CPU表示物理地址</strong></h5><p>如果物理总线宽度超过寄存器宽度，CPU寻址方法是两个寄存器输出一个地址，当地址总线宽度20的时候，P21图。一个寄存器输出短地址，另一个输出偏移地址。然后通过地址加法器合并为一个20位的地址，然后通过内部总线送给控制电路，控制电路通过地址总线送给内存。</p>
<p>公式：物理地址=段地址x16+偏移地址（这里的x16其实就是左移四位，P21图）</p>
<p>虽然这么表示，但内存并没有被分为一段一段的，是CPU划分的段。段地址x16称为基础地址，所以我们可以根据需求把任意的基础地址加上不超过一个寄存器表示的最长（64KB）的偏移地址来表示地址。而且一个实际地址往往可以有各种不同的方法表示，通常我们表示21F60H这个地址通过下面方法：</p>
<ul>
<li>2000:1F60</li>
<li>2000H段中的1F60单元中</li>
</ul>
<h5 id="段寄存器与指令指针寄存器"><a href="#段寄存器与指令指针寄存器" class="headerlink" title="段寄存器与指令指针寄存器"></a><strong>段寄存器与指令指针寄存器</strong></h5><p>8086CPU有四个段寄存器：CS,DS,SS,ES</p>
<p>除此之外，IP寄存器称为指令指针寄存器，所以任意时刻可以读取从CSx16+IP单元开始，读取一条指令执行。也就是说，CPU将IP指向的内容当做指令执行。</p>
<p>P26图，CPU执行一段指令。另外，8086CPU开机时CS被置为FFFFH，IP被置为0000H，也就是说刚开机的第一条指令从FFFF0H开始读取执行。</p>
<p>CPU将CS:IP指向的内存中的内容当做指令，一条指令被执行了，那一定被CS:IP指向过。</p>
<h5 id="修改CS，IP"><a href="#修改CS，IP" class="headerlink" title="修改CS，IP"></a><strong>修改CS，IP</strong></h5><p>CS和IP寄存器不可以使用传送指令mov来改变，而能改变CS，IP内容的指令是转移指令。</p>
<p>jmp指令用法：</p>
<ul>
<li>jmp 段地址:偏移地址 同时修改CS和IP的值 如jmp 2AE3:3 结果CS=2AE3H IP=0003H</li>
<li>jmp 某一合法寄存器 只修改IP的值 如jmp ax，将IP的值置为AX中的值（AX不变）</li>
</ul>
<h5 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a><strong>小结</strong></h5><p>8086CPU有四个段寄存器，CS是用来存放指令的段地址的段寄存器</p>
<p>IP用来存放指令的偏移地址</p>
<p>CS:IP指向的内容在任意时刻会被当做指令执行</p>
<p>使用转移指令修改CS和IP的内容</p>
<h5 id="实验"><a href="#实验" class="headerlink" title="实验"></a><strong>实验</strong></h5><p>Debug命令：</p>
<ul>
<li>R：查看，改变CPU寄存器内容<ul>
<li>直接-r查看寄存器内容</li>
<li>-r 寄存器名，改变寄存器内容</li>
</ul>
</li>
<li>D：查看内存中内容<ul>
<li>-d直接查看</li>
<li>-d 段地址:偏移地址 查看固定地址开始的内容</li>
<li>-d 段地址:偏移地址 结尾偏移地址 查看指定范围内存</li>
</ul>
</li>
<li>E：改写内存中内容<ul>
<li>-e 起始地址 数据 数据 数据 …</li>
<li>提问方式修改 -e 段地址:偏移地址 从这个地址开始一个一个改，空格下一个，回车结束</li>
<li>也可以写入字符 ‘a’</li>
</ul>
</li>
<li>U：将内存中的机器指令翻译成汇编指令<ul>
<li>-u 段地址:偏移地址</li>
</ul>
</li>
<li>T：执行一条机器指令<ul>
<li>-t 执行cs:ip指向的命令</li>
</ul>
</li>
<li>A：以汇编指令格式在内存中写入一条机器指令<ul>
<li>-a 段地址:偏移地址 从这个地址开始一行一行的写入汇编语句</li>
</ul>
</li>
</ul>
<h3 id="寄存器（内存访问）"><a href="#寄存器（内存访问）" class="headerlink" title="寄存器（内存访问）"></a>寄存器（内存访问）</h3><h5 id="内存到寄存器的储存"><a href="#内存到寄存器的储存" class="headerlink" title="内存到寄存器的储存"></a><strong>内存到寄存器的储存</strong></h5><p>寄存器是16位的，可以存放一个字即两个字节，而内存中的一个存储单元是一字节。所以一个寄存器可以存两个存储单元的内容，高地址存储单元存在高位字节中，低地址存储单元存在低位字节中。</p>
<p>字单元：存放一个字型数据的两个地址连续的内存单元。</p>
<h5 id="DS寄存器"><a href="#DS寄存器" class="headerlink" title="DS寄存器"></a><strong>DS寄存器</strong></h5><p>与CS类似，DS寄存器存放的是要从内存中读取的数据的段地址。我们想要使用mov指令从内存10000H（1000:0）中的数据送给AL时，如下：</p>
<p>mov al,[0]</p>
<p>后面的[0]指的是内存的偏移地址是0，CPU会自动从DS寄存器中提取段地址，所以应该首先将段地址1000H写入DS寄存器中。但却不能直接使用mov ds,1000指令，只能从其他寄存器中转传入DS寄存器。所以完整命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov bx,1000</span><br><span class="line">mov ds,bx</span><br><span class="line">mov al,[0]</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>当然，从AL寄存器中将数据送入内存只要反过来使用mov就可以了，mov [0],al</p>
<p>如果需要传输字型数，只要使用对应的16位寄存器就可以了，传输的是以相应地址开始的一个字型数据（连续两个字节）。如mov [0],cx。</p>
<h5 id="mov，add，sub"><a href="#mov，add，sub" class="headerlink" title="mov，add，sub"></a><strong>mov，add，sub</strong></h5><p>mov常见语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mov 寄存器,数据       mov ax,8</span><br><span class="line">mov 寄存器,寄存器		mov ax,bx</span><br><span class="line">mov 寄存器,内存单元    mov ax,[0]</span><br><span class="line">mov 内存单元,寄存器    mov [0],ax</span><br><span class="line">mov 段寄存器,寄存器    mov ds,ax</span><br><span class="line">mov 寄存器,段寄存器    mov ax,ds</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>

<p>add，sub常见语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">add 寄存器,数据        add ax,8</span><br><span class="line">add 寄存器,寄存器      add ax,bx</span><br><span class="line">add 寄存器,内存单元    add ax,[0]</span><br><span class="line">add 内存单元,寄存器    add [0],ax</span><br><span class="line">sub和add一样</span><br><span class="line">12345</span><br></pre></td></tr></table></figure>

<p>注意，add，sub不可以操作段寄存器。</p>
<h5 id="栈"><a href="#栈" class="headerlink" title="栈"></a><strong>栈</strong></h5><p>栈是一种后进先出的存储空间，从栈顶出栈入栈。LIFO（last in first out）</p>
<p>入栈指令：push ax ax中的数据送入栈顶</p>
<p>出栈指令：pop ax 栈顶送入ax</p>
<p>入栈和出栈指令都是以字为单位的。P58图</p>
<h5 id="栈寄存器SS，SP与push，pop"><a href="#栈寄存器SS，SP与push，pop" class="headerlink" title="栈寄存器SS，SP与push，pop"></a><strong>栈寄存器SS，SP与push，pop</strong></h5><p>CPU通过SS寄存器和SP寄存器来知道栈的范围，段寄存器SS存放的是栈顶的段地址，SP寄存器存放的是栈顶的偏移地址。所以，任意时刻SS:SP指向栈顶元素。</p>
<p>指令push ax执行过程：</p>
<ol>
<li>SP=SP-2，SP指针向前移动两格代表新栈顶</li>
<li>AX中的数据送入SS:SP目前指向的内存字单元，P59图</li>
</ol>
<p>所以栈顶在低地址，栈底在高地址。初始状态下，SP指向栈底的下一个单元。</p>
<p>反之pop ax执行过程相反。</p>
<p>8086CPU并不会自己检测push是否会超栈顶，pop是否会超栈底。</p>
<p>push和pop可以加寄存器，段寄存器，内存单元（直接偏移地址[address]）</p>
<p>指定栈空间通常通过指定SS来进行，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">指定10000H~1000FH为栈空间</span><br><span class="line">mov ax,1000</span><br><span class="line">mov ss,ax</span><br><span class="line">mov sp 0010</span><br><span class="line">1234</span><br></pre></td></tr></table></figure>

<p>注：将一个寄存器清零 sub ax,ax 两个字节，mov ax,0 三个字节</p>
<p>注：若设定一个栈段为10000H~1FFFFH，栈空的时候SP=0（要知道入栈操作先SP-2，然后再送入栈）</p>
<h5 id="实验-1"><a href="#实验-1" class="headerlink" title="实验"></a><strong>实验</strong></h5><p>Debug中的t命令一次执行一条指令，但如果执行的指令修改了ss段寄存器，下一条命令也会紧跟着执行（中断机制）。</p>
<h3 id="简单编程"><a href="#简单编程" class="headerlink" title="简单编程"></a>简单编程</h3><h5 id="一个汇编语言程序"><a href="#一个汇编语言程序" class="headerlink" title="一个汇编语言程序"></a><strong>一个汇编语言程序</strong></h5><ol>
<li>编写</li>
<li>编译（masm5.0）</li>
<li>连接</li>
</ol>
<h5 id="一些伪指令功能"><a href="#一些伪指令功能" class="headerlink" title="一些伪指令功能"></a><strong>一些伪指令功能</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">assume cs:codesg</span><br><span class="line"></span><br><span class="line">codesg segment</span><br><span class="line"></span><br><span class="line">mov ax,0123</span><br><span class="line">mov bx,0456</span><br><span class="line">add ax,bx</span><br><span class="line">add ax,ax</span><br><span class="line"></span><br><span class="line">mov ax,4c00</span><br><span class="line">int 21</span><br><span class="line"></span><br><span class="line">codesg ends</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line">123456789101112131415</span><br></pre></td></tr></table></figure>

<p>涉及到的一些知识：</p>
<ul>
<li>XXX segment···XXXends<ul>
<li>segment和ends成对出现，代表一个段的开始和结束。</li>
<li>一个汇编程序可以有多个段，代码，数据和栈等，至少要有一个段。</li>
</ul>
</li>
<li>end<ul>
<li>end代表一个汇编程序结束，遇到end编译器停止编译。</li>
</ul>
</li>
<li>assume<ul>
<li>assume 假设，假设某一个段寄存器和程序中的一个段关联。</li>
<li>可以理解为将这个段寄存器指向程序段的段地址</li>
</ul>
</li>
<li>标号（codesg）<ul>
<li>一个标号代表一个地址</li>
</ul>
</li>
<li>程序返回mov ax,4c00 int 21<ul>
<li>暂时记住这两条指令代表程序返回</li>
</ul>
</li>
</ul>
<p>编译和连接方法，P83。</p>
<p>注：编译器只能发现语法错误而无法发现逻辑错误。</p>
<p>CPU执行一个程序，需要有另一个程序将它加载进内存（即将CS:IP指向它），一般情况下我们通过DOS执行这个.exe，所以是DOS程序将它加载进入内存。当这个程序运行结束，再返回DOS程序继续执行。如果是DOS调用Debug调用.exe，那么先返回Debug再返回DOS。</p>
<p>DOS加载一个.exe时，先在内存中找到一段内存，起始段地址SA，然后分配256字节的PSP区域，用来和被加载程序通信。在之后的段地址SA+10就是程序开始的段地址。CS:IP指向它，DS=SA。</p>
<p>注：在Debug中，最后的int 21指令要使用P命令执行。</p>
<h3 id="BX-和loop指令"><a href="#BX-和loop指令" class="headerlink" title="[BX]和loop指令"></a>[BX]和loop指令</h3><h5 id="内存单元的描述"><a href="#内存单元的描述" class="headerlink" title="内存单元的描述"></a><strong>内存单元的描述</strong></h5><p>内存单元可以使用[数字]表示，当然也可以使用[寄存器]表示，如[bx]，mov ax,[bx]，mov al,[bx]</p>
<p>为了表示方便，使用()来表示一个内存单元或寄存器中的内容，如(ax),(20000H)，或((dx)*16+(bx))表示ds:bx中的内容，但不可写为(1000:0),((dx):0H)。而(X)中的内容由具体寄存器名或运算来决定。</p>
<p>我们使用idata来表示常亮。所以以下语句可以这么写：mov ax,[idata] mov ax,idata。</p>
<h5 id="loop指令"><a href="#loop指令" class="headerlink" title="loop指令"></a><strong>loop指令</strong></h5><p>loop指令格式：loop 标号。</p>
<p>loop指令通常用来实现循环功能，当执行loop指令时，CPU进行两步操作：</p>
<ol>
<li>(cx)=(cx)-1</li>
<li>(cx)不为零则跳至标号处执行程序。</li>
</ol>
<p>所以CX中存放的是循环次数，一个简单的例子如下（计算2^12）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line"></span><br><span class="line">mov ax,2</span><br><span class="line"></span><br><span class="line">mov cx,11</span><br><span class="line">s:add ax,ax</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end</span><br><span class="line">1234567891011121314</span><br></pre></td></tr></table></figure>

<p>所以使用loop注意三点：</p>
<ol>
<li>先设置cx的值 mov cx,循环次数</li>
<li>设置标号与执行循环的程序段 s:执行程序段</li>
<li>在程序段最后写loop loop</li>
</ol>
<p>注：在汇编语言中，数据不能以字母开头，所以大于9fffH的数据，要在开头加0，如0A000H</p>
<p>注：debug中G命令 g 0012表示CPU从当前CS:IP开始一直执行到0012处暂停。P命令可以将loop部分一次执行完毕，直到(CX)=0，或使用g loop的下一条命令。</p>
<h5 id="Debug和masm编译器对指令的不同处理"><a href="#Debug和masm编译器对指令的不同处理" class="headerlink" title="Debug和masm编译器对指令的不同处理"></a><strong>Debug和masm编译器对指令的不同处理</strong></h5><p>mov ax,[0]这条指令在Debug和masm中有着不同的解释，Debug是将DS:0内存中的数据送给AX，而masm中则是mov ax,0，即将0送入AX。</p>
<p>解决方法1：先将偏移地址送入BX，然后再使用mov ax,[bx]</p>
<p>解决方法2：直接显式给出地址，如mov al，ds:[0] （相应的段寄存器还有CS,SS,ES这些在汇编语言中可以称为“段前缀”）当然，这种写法通过编译器之后会变成Debug中的mov al,[0]</p>
<p>注：inc bx bx值加一</p>
<h5 id="安全的编程空间"><a href="#安全的编程空间" class="headerlink" title="安全的编程空间"></a><strong>安全的编程空间</strong></h5><p>在之前没有提到的一个问题，如果在写程序之前不看一眼要操作的内存，就直接开始使用的话，万一改写了内存中重要的系统数据，可能会引起系统崩溃。所以我们一般在一个安全的内存空间中操作。一般操作系统和合法程序都不会使用0:200~0:2ff这256字节的空间，所以我们可以在这里操作。</p>
<p>学习汇编语言的目的就是直接和硬件对话，而不理会操作系统，这在DOS（实模式）下是可以做到的，但在windows或Unix这种运行与CPU保护模式的操作系统上却是不可能的，因为这种操作系统已经将CPU全面严格的管理了。</p>
<h5 id="段前缀的使用"><a href="#段前缀的使用" class="headerlink" title="段前缀的使用"></a><strong>段前缀的使用</strong></h5><p>将ffff:0ffff:b中的数据转存入0:2000:20b中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line"></span><br><span class="line">mov ax,0ffffh</span><br><span class="line">mov ds,ax</span><br><span class="line"></span><br><span class="line">mov ax,0020h</span><br><span class="line">mov es,ax</span><br><span class="line"></span><br><span class="line">mov bx,0</span><br><span class="line"></span><br><span class="line">mov cx,12</span><br><span class="line">s:mov dl,[bx]</span><br><span class="line">mov es:[bx],dl</span><br><span class="line">inc bx</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end</span><br><span class="line">12345678910111213141516171819202122</span><br></pre></td></tr></table></figure>

<p>[bx]直接使用的时候默认段前缀是ds，但要使用其他的段前缀，如es就要在前面加上。</p>
<h3 id="程序的段"><a href="#程序的段" class="headerlink" title="程序的段"></a>程序的段</h3><h5 id="数据段"><a href="#数据段" class="headerlink" title="数据段"></a><strong>数据段</strong></h5><p>一般一个程序想要使用内存空间，有两种方法，在程序加载的时候系统分配或在需要使用的时候向系统申请，我们先考虑第一种情况。所以我们应事先将所需的数据存入内存中的某一段中，但我们又不可以随意的指定内存地址，以下面的求8个数据累加和的代码为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line"></span><br><span class="line">dw 0123h,0456h,0789h,0abch,0defh,0fedh,0cbah,0987h</span><br><span class="line"></span><br><span class="line">mov bx,0</span><br><span class="line">mov ax,0</span><br><span class="line"></span><br><span class="line">mov cx,8</span><br><span class="line">s:add ax,cs:[bx]</span><br><span class="line">add bx,2</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end</span><br><span class="line">123456789101112131415161718</span><br></pre></td></tr></table></figure>

<p>代码第一行的dw是定义字类型数据，define word的意思。这里定义了8个字类型数据，占16字节。由于是在程序最开始定义的dw，所以数据段的偏移地址为0，也就是说第一个数据0123h的地址是CS:[0]第二个0456h的地址是CS:[2]以此类推。</p>
<p>所以这个程序加载之后CS:IP指向的是数据段的第一个数据，我们要是想成功执行，需要把IP置10，指向第一条指令mov bx,0，所以我们想要直接执行（不在Debug中调整IP）的话，需要指定程序开始的地方：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">dw 0123h,0456h,0789h,0abch,0defh,0fedh,0cbah,0987h</span><br><span class="line"></span><br><span class="line">start:mov bx,0</span><br><span class="line">···</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">1234567</span><br></pre></td></tr></table></figure>

<p>在第一条指令前加start，后面的end变成end start，end除了通知编译器程序在哪里结束之外，也可以通知程序的入口在哪，也就是第一条语句，在这里编译器就知道了mov bx,0是程序的第一条指令。也就是说，我们想要CPU从何处开始执行程序，只要在源程序中使用end 标号指定就好了。</p>
<p>所以有如下框架：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line">···数据···</span><br><span class="line">start:</span><br><span class="line">···代码···</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">1234567</span><br></pre></td></tr></table></figure>

<h5 id="栈段"><a href="#栈段" class="headerlink" title="栈段"></a><strong>栈段</strong></h5><p>看下面一段使8个数逆序存放的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">assume cs:codesg</span><br><span class="line">codesg segment</span><br><span class="line"></span><br><span class="line">dw 0123h,0456h,0789h,0abch,0defh,0fedh,0cbah,0987h</span><br><span class="line">dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class="line"></span><br><span class="line">start:mov ax,cs</span><br><span class="line">mov ss,ax</span><br><span class="line">mov sp,30h</span><br><span class="line"></span><br><span class="line">mov bx,0</span><br><span class="line">mov cx,8</span><br><span class="line">s:push cs:[bx]</span><br><span class="line">add bx,2</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">mov bx,0</span><br><span class="line">mov cx,8</span><br><span class="line">s0:pop cs:[bx]</span><br><span class="line">add bx,2</span><br><span class="line">loop s0</span><br><span class="line"></span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">codesg ends</span><br><span class="line">end start</span><br><span class="line">123456789101112131415161718192021222324252627</span><br></pre></td></tr></table></figure>

<p>在定义了8个字型数据之后，又定义了16个取值为0的字型数据，用作栈空间。所以dw这个定义不仅仅用来定义数据，也可以用来开辟内存空间留给之后的程序使用。</p>
<h5 id="数据，代码，栈的程序段"><a href="#数据，代码，栈的程序段" class="headerlink" title="数据，代码，栈的程序段"></a><strong>数据，代码，栈的程序段</strong></h5><p>在8086CPU中，一个段的长度最大为64KB，所以如果我们将数据或栈空间定义的比较大，就不能像前面一样编程了。我们需要将代码，数据，栈放入不同的段中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code,ds:data,ss:stack</span><br><span class="line">data segment</span><br><span class="line">dw 0123h,0456h,0789h,0abch,0defh,0fedh,0cbah,0987h</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">stack segment</span><br><span class="line">dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class="line">srack ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:mov ax,stack</span><br><span class="line">mov ss,ax</span><br><span class="line">mov sp,20h</span><br><span class="line"></span><br><span class="line">mov ax,data</span><br><span class="line">mov ds,ax</span><br><span class="line"></span><br><span class="line">mov bx,0</span><br><span class="line"></span><br><span class="line">mov cx,8</span><br><span class="line">s:push [bx]</span><br><span class="line">add bx,2</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">mov bx,0</span><br><span class="line"></span><br><span class="line">mov cx,8</span><br><span class="line">s0:pop [bx]</span><br><span class="line">add bx,2</span><br><span class="line">loop s0</span><br><span class="line"></span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">123456789101112131415161718192021222324252627282930313233343536</span><br></pre></td></tr></table></figure>

<p>我们可以这样在写代码时就将程序分为几个段，这段代码中，mov ax,data的意思是将data段的段地址送入ax寄存器。但我们不可以使用mov ds,data这样是错误的，因为在这里data被编译器视为一个数值。</p>
<p>在这里将数据命名为data，代码命名为code，栈命名为stack只是为了方便阅读，CPU并不能理解，和start，s，s0一样，只在源程序中使用。而assume cs:code,ds:data,ss:stack这段代码也并不能让CPU的cs，ds，ss指向对应的段，因为assume是伪指令，CPU并不认识，它是由编译器执行的。源程序中end start语句指明了程序的入口，在这个程序被加载后，CS:IP被指向start处，开始执行第一条语句，这样CPU才会将code段当做代码执行。而当CPU执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov ax,stack</span><br><span class="line">mov ss,ax</span><br><span class="line">mov sp,20h</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>这三条语句后才会将stack段当做栈空间开使用。也就是说，CPU如何区分哪个段的功能，全靠我们使用汇编指令对ds，ss，cs寄存器的内容设置来指定。</p>
<h3 id="灵活定位内存地址"><a href="#灵活定位内存地址" class="headerlink" title="灵活定位内存地址"></a>灵活定位内存地址</h3><h5 id="and和or指令"><a href="#and和or指令" class="headerlink" title="and和or指令"></a><strong>and和or指令</strong></h5><p>and：逻辑与指令，按位与运算，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov al,01100011B</span><br><span class="line">and al,00111011B</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>执行结果是al=00100011B，所以我们想要把某一位置零的时候可以使用and指令。</p>
<p>or：逻辑或指令，按位或运算，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov al,01100011B</span><br><span class="line">or al,00111011B</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>执行结果是al=01111011B，or指令可以将相应位置1。</p>
<h5 id="ASCII码和字符形式的数据"><a href="#ASCII码和字符形式的数据" class="headerlink" title="ASCII码和字符形式的数据"></a><strong>ASCII码和字符形式的数据</strong></h5><p>在汇编语言中我们可以使用’···’的方式指明数据是以字符形式给出的，编译器会自动将它们转化为ASCII码。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code,ds:data</span><br><span class="line">data segment</span><br><span class="line">db &#39;unIX&#39;</span><br><span class="line">db &#39;foRK&#39;</span><br><span class="line">data ends</span><br><span class="line">code segment</span><br><span class="line">start:mov al,&#39;a&#39;</span><br><span class="line">mov bl,&#39;b&#39;</span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">123456789101112</span><br></pre></td></tr></table></figure>

<p>db和dw类似，只不过定义的是字节型数据，然后通过’unIX’相继在接下来四个字节中写下75H,6EH,49H,58H即unIX的ASCII值。同理,mov al,’a’也是将’a’的ASCII值61H送入al寄存器。</p>
<p>使用and和or指令改变一串字符串字母的大小写，将第一串全变为大写，第二串全变为小写：</p>
<p>首先分析ASCII码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">大写	十六进制	二进制			小写	十六进制	二进制</span><br><span class="line"> A		41		01000001		a		61	   01100001</span><br><span class="line"> B		42		01000010		b		62	   01100010</span><br><span class="line"> C 		43		01000011		c		63	   01100011</span><br><span class="line">1234</span><br></pre></td></tr></table></figure>

<p>可见，只有第5位（从右往左数，从0开始计数）在大写和小写的二进制中是不一样的，所以我们只要把所有字母的二进制第五位置零，那就是大写，置1就是小写。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">assume cs:codesg,ds:datasg</span><br><span class="line"></span><br><span class="line">datasg segment</span><br><span class="line">db &#39;BaSiC&#39;</span><br><span class="line">db &#39;iNfOrMaTiOn&#39;</span><br><span class="line">datasg ends</span><br><span class="line"></span><br><span class="line">codesg segment</span><br><span class="line">start:mov ax,datasg</span><br><span class="line">mov ds,ax</span><br><span class="line">mov bx,0</span><br><span class="line"></span><br><span class="line">mov cx,5</span><br><span class="line">s:mov al,[bx]</span><br><span class="line">and al,11011111B</span><br><span class="line">mov [bx],al</span><br><span class="line">inc bx</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">mov bx,5</span><br><span class="line"></span><br><span class="line">mov cx,11</span><br><span class="line">s0:mov al,[bx]</span><br><span class="line">or al,00100000B</span><br><span class="line">mov [bx],al</span><br><span class="line">inc bx</span><br><span class="line">loop s0</span><br><span class="line"></span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">codesg ends</span><br><span class="line">end start</span><br><span class="line">123456789101112131415161718192021222324252627282930313233</span><br></pre></td></tr></table></figure>

<h5 id="bx-idata-的内存表示方法与数组处理"><a href="#bx-idata-的内存表示方法与数组处理" class="headerlink" title="[bx+idata]的内存表示方法与数组处理"></a><strong>[bx+idata]的内存表示方法与数组处理</strong></h5><p>除了使用[bx]来表示一个内存单元外，我们还可以使用[bx+idata]来表示一个内存单元，他表示的意思是偏移地址为(bx)+idata（bx中的数值加idata）的内存单元。当然也可写为[idata+bx]，除此之外还可写为，200[bx]，[bx].200。</p>
<p>既然有了这种表示方法，我们就可以使用这种方法来操作数组，刚才将两个字符串改变大小写的代码的循环部分可以如下优化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">s:mov al,[bx]</span><br><span class="line">and al,11011111B</span><br><span class="line">mov [bx],al</span><br><span class="line">mov al,[5+bx]</span><br><span class="line">or al,00100000B</span><br><span class="line">mov [5+bx],al</span><br><span class="line">inc bx</span><br><span class="line">loop s</span><br><span class="line">···</span><br><span class="line">12345678910</span><br></pre></td></tr></table></figure>

<p>当然也可写为0[bx]和5[bx]，注意这种写法和C语言中数组的相似之处：C语言中数组表示为a[i]，汇编语言中表示为5[bx]。</p>
<h5 id="SI和DI寄存器"><a href="#SI和DI寄存器" class="headerlink" title="SI和DI寄存器"></a><strong>SI和DI寄存器</strong></h5><p>SI和DI功能和BX相似，但不可以拆分为两个8位寄存器。也就是说下面代码等价：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov bx|si|di,0</span><br><span class="line">mov ax,[bx|si|di]</span><br><span class="line">mov ax,[bx|si|di+123]</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>所以在这里可以使用更方便的方式：[bx+si]和[bx+di]，这两个式子表示偏移地址为(bx)+(si)的内存单元，使用方法如：mov ax,[bx+si]等价于<code>mov ax,[bx][si]。</code></p>
<p>当然，有了这些表示方法，自然就有[bx+si+idata]和[bx+di+idata]，相似的，也可以写成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov ax,[bx+200+si]</span><br><span class="line">mov ax,[200+bx+si]</span><br><span class="line">mov ax,200[bx][si]</span><br><span class="line">mov ax,[bx].200[si]</span><br><span class="line">mov ax,[bx][si].200</span><br><span class="line">12345</span><br></pre></td></tr></table></figure>

<p>那我们总结一下这些内存寻址方法：</p>
<ul>
<li>[idata]用一个常量表示偏移地址，直接定位一个内存单元</li>
<li>[bx]用一个变量表示偏移地址，定位一个内存单元</li>
<li>[bx+idata]用一个常量和一个变量表示偏移地址，可在一个起始地址的基础上间接定位一个内存单元</li>
<li>[bx+si]用两个变量表示偏移地址</li>
<li>[bx+si+idata]用两个变量和一个常量表示偏移地址</li>
</ul>
<p>使用双循环，使用一个寄存器暂存cs的值，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">mov cx,4</span><br><span class="line">s0:mov dx,cx</span><br><span class="line">mov si,0</span><br><span class="line"></span><br><span class="line">mov cx,3</span><br><span class="line">s:mov al,[bx+si]</span><br><span class="line">and al,11011111b</span><br><span class="line">mov [bx+si],al</span><br><span class="line">inc si</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">add bx,16</span><br><span class="line">mov cx,dx</span><br><span class="line">loop s0</span><br><span class="line">···</span><br><span class="line">12345678910111213141516</span><br></pre></td></tr></table></figure>

<p>假如循环比较复杂，没有多余的寄存器可用，我们可以使用内存暂存cx或其他数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">dw 0</span><br><span class="line">···</span><br><span class="line">mov cx,4</span><br><span class="line">s0:mov ds:[40H],cx</span><br><span class="line">mov si,0</span><br><span class="line"></span><br><span class="line">mov cx,3</span><br><span class="line">s:mov al,[bx+si]</span><br><span class="line">and al,11011111b</span><br><span class="line">mov [bx+si],al</span><br><span class="line">inc si</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">add bx,16</span><br><span class="line">mov cx,ds:[40H]</span><br><span class="line">loop s0</span><br><span class="line">···</span><br><span class="line">123456789101112131415161718</span><br></pre></td></tr></table></figure>

<p>这么使用的话注意需要在数据段声明用来暂存的内存，好在程序加载时分配出来。当然，在需要暂存的地方，还是建议使用栈：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">dw 0,0,0,0,0,0,0,0</span><br><span class="line">···</span><br><span class="line">mov ax,stacksg</span><br><span class="line">mov ss,ax</span><br><span class="line">mov sp,16</span><br><span class="line">···</span><br><span class="line">mov cx,4</span><br><span class="line">s0:push cx</span><br><span class="line">mov si,0</span><br><span class="line"></span><br><span class="line">mov cx,3</span><br><span class="line">s:mov al,[bx+si]</span><br><span class="line">and al,11011111b</span><br><span class="line">mov [bx+si],al</span><br><span class="line">inc si</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">add bx,16</span><br><span class="line">pop cx</span><br><span class="line">loop s0</span><br><span class="line">···</span><br><span class="line">12345678910111213141516171819202122</span><br></pre></td></tr></table></figure>

<h3 id="数据处理的两个基本问题"><a href="#数据处理的两个基本问题" class="headerlink" title="数据处理的两个基本问题"></a>数据处理的两个基本问题</h3><h5 id="两个基本问题"><a href="#两个基本问题" class="headerlink" title="两个基本问题"></a><strong>两个基本问题</strong></h5><ol>
<li>处理的数据在什么地方</li>
<li>要处理的数据有多长</li>
</ol>
<p>接下来的讨论中，使用reg来表示一个寄存器，使用sreg来表示一个段寄存器。所以：</p>
<ul>
<li>reg：ax,bx,cx,dx,ah,al,bh,bl,ch,cl,dh,dl,sp,bp,si,di</li>
<li>sreg：ds,ss,cs,es</li>
</ul>
<h5 id="bx，si，di和bp"><a href="#bx，si，di和bp" class="headerlink" title="bx，si，di和bp"></a><strong>bx，si，di和bp</strong></h5><p>在8086CPU中，只有这四个寄存器可以使用[···]来进行内存寻址，可以单个出现，或以下面组合出现（常数可以随意出现在这些表示方法中）：</p>
<ul>
<li>bx+si/di</li>
<li>bp+si/di</li>
</ul>
<p>注：如果使用了bp来寻址，而没有显式的表明段地址，默认使用ss段寄存器，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov ax,[bp]              ;(ax)&#x3D;((ss)*16+(bp))</span><br><span class="line">mov ax,[bp+idata]        ;(ax)&#x3D;((ss)*16+(bp)+idata)</span><br><span class="line">mov ax,[bp+si]           ;(ax)&#x3D;((ss)*16+(bp)+(si)+idata)</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<h5 id="数据的位置"><a href="#数据的位置" class="headerlink" title="数据的位置"></a><strong>数据的位置</strong></h5><p>绝大部分机器指令都是用来处理数据的，基本可分为读取，写入，运算。在机器指令这个层面上，并不关心数据是什么，而关心指令执行前数据的位置。一般数据会在三个地方，CPU内部，内存，端口。</p>
<p>汇编语言中使用三个概念来表示数据的位置：</p>
<ul>
<li>立即数（idata）<ul>
<li>对于直接包含在机器指令中的数据，在汇编语言中称为立即数</li>
<li>例：mov ax,1 add bx,2000h</li>
</ul>
</li>
<li>寄存器<ul>
<li>指令要处理的数据在寄存器中，在汇编指令中给出相应寄存器名</li>
<li>例：mov ax,bx mov ds,ax</li>
</ul>
</li>
<li>段地址（SA）和偏移地址（EA）<ul>
<li>指令要处理的数据在内存中，在指令中使用[X]方式给出，SA在某个段寄存器中</li>
<li>例：mov ax,[0] mov ax,[di]</li>
</ul>
</li>
</ul>
<p>总结一下寻址方式：</p>
<table>
<thead>
<tr>
<th>寻址方式</th>
<th>含义</th>
<th>名称</th>
</tr>
</thead>
<tbody><tr>
<td>[idata]</td>
<td>EA=idata;SA=(DS)</td>
<td>直接寻址</td>
</tr>
<tr>
<td>[bx|si|di|bp]</td>
<td>EA=(bx|si|di|bp);SA=(DS)</td>
<td>寄存器间接寻址</td>
</tr>
<tr>
<td>[bx|si|di|bp+idata]</td>
<td>EA=(bx|si|di|bp+idata);SA=(DS)</td>
<td>寄存器相对寻址</td>
</tr>
<tr>
<td>[bx|bp+si|di]</td>
<td>EA=(bx|bp+si|di);SA=(DS|SS)</td>
<td>基址变址寻址</td>
</tr>
<tr>
<td>[bx|bp+si|di+idata]</td>
<td>EA=(bx|bp+si|di+idata);SA=(DS|SS)</td>
<td>相对基址变址寻址</td>
</tr>
</tbody></table>
<h5 id="数据的长度"><a href="#数据的长度" class="headerlink" title="数据的长度"></a><strong>数据的长度</strong></h5><p>8086CPU中可以指定两种尺寸的数据，byte和word，所以在使用数据的时候要指明数据尺寸。</p>
<ul>
<li>在有寄存器参与的时候使用寄存器的种类区分<ul>
<li>字：mov ax,1</li>
<li>字节：mov al,1</li>
</ul>
</li>
<li>在没有寄存器参与的时候，使用X ptr指明内存单元长度，X是word或byte<ul>
<li>字：mov word ptr ds:[0],1 add word ptr [bx],2</li>
<li>字节：mov byte ptr ds:[0],1 add byte ptr [bx],2</li>
</ul>
</li>
<li>其他默认指明处理类型的指令<ul>
<li>push [1000H]，push默认只进行字操作</li>
</ul>
</li>
</ul>
<p>灵活使用寻址方式的例子，修改下面内存空间中的数据：</p>
<p>段seg:60</p>
<table>
<thead>
<tr>
<th>起始地址</th>
<th>内容</th>
</tr>
</thead>
<tbody><tr>
<td>00</td>
<td>‘DEC’</td>
</tr>
<tr>
<td>03</td>
<td>‘Ken Oslen’</td>
</tr>
<tr>
<td>0C</td>
<td>137</td>
</tr>
<tr>
<td>0E</td>
<td>40</td>
</tr>
<tr>
<td>10</td>
<td>‘PDP’</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">mov ax,seg</span><br><span class="line">mov ds,ax</span><br><span class="line">mov bx,60h</span><br><span class="line"></span><br><span class="line">mov word ptr [bx].0ch,38    ;第三字段改为38</span><br><span class="line"></span><br><span class="line">add word ptr [bx].0eh,70    ;第四字段改为70</span><br><span class="line"></span><br><span class="line">mov si,0</span><br><span class="line">mov byte ptr [bx].10h[si],&#39;v&#39;   ;修改最后一个字段的三个字符</span><br><span class="line">inc si</span><br><span class="line">mov byte ptr [bx].10h[si],&#39;A&#39;</span><br><span class="line">inc si</span><br><span class="line">mov byte ptr [bx].10h[si],&#39;X&#39;</span><br><span class="line">···</span><br><span class="line">12345678910111213141516</span><br></pre></td></tr></table></figure>

<p>这段代码中地址的使用类似c++中结构体的使用。[bx].idata.[si]，就类似与c++中的dec.cp[i]。dec是结构体，cp是结构体中的字符串成员，[i]表示第几个字符。</p>
<h5 id="div指令"><a href="#div指令" class="headerlink" title="div指令"></a><strong>div指令</strong></h5><p>div是除法指令，需要注意以下三点：</p>
<ul>
<li>除数：8位或16位，在一个reg或内存单元中</li>
<li>被除数：默认在AX或DX中，如果除数8位，被除数则为16位，放在AX中；如果除数16位，则被除数32位，在DX和AX中，DX存放高16位，AX放低16位。</li>
<li>结果，除数8位，结果（商）存放在AL中，AH存放余数；如果除数16位，则AX存放商，DX存放余数</li>
</ul>
<p>格式：div reg或div 内存单元，所以div byte ptr ds:[0]表示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(al)&#x3D;(ax)&#x2F;((ds)*16+0)的商;</span><br><span class="line">(ah)&#x3D;(ax)&#x2F;((ds)*16+0)的余数；</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>div word ptr es:[0]表示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(al)&#x3D;[(dx)*10000H+(ax)]&#x2F;((es)*16+0)的商</span><br><span class="line">(ah)&#x3D;[(dx)*10000H+(ax)]&#x2F;((es)*16+0)的余数</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>例：计算100001/100，因为100001(186A1H)大于65535，则需要存放在ax和dx两个寄存器，那么除数100只能存放在一个16位的寄存器中，实现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov dx,1</span><br><span class="line">mov ax,86A1H</span><br><span class="line">mov bx,100</span><br><span class="line">div bx</span><br><span class="line">1234</span><br></pre></td></tr></table></figure>

<p>执行之后(ax)=03E8H(1000),(dx)=1。</p>
<h5 id="伪指令dd"><a href="#伪指令dd" class="headerlink" title="伪指令dd"></a><strong>伪指令dd</strong></h5><p>dd是一个伪指令，类似dw，但dd是用来定义dword（double word，双字），如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dd 1  ;2字，4字节</span><br><span class="line">dw 1  ;1字，2字节</span><br><span class="line">db 1  ;1字节</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>将data段中第一个数据除以第二个数据，商存入第三个数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">data segment</span><br><span class="line">dd 100001</span><br><span class="line">dw 100</span><br><span class="line">dw 0</span><br><span class="line">data ends</span><br><span class="line">···</span><br><span class="line">mov ax,data</span><br><span class="line">mov ds,ax</span><br><span class="line">mov ax,ds:[0]</span><br><span class="line">mov dx,ds:[2]</span><br><span class="line">div word ptr ds:[4]</span><br><span class="line">mov ds:[6],ax</span><br><span class="line">···</span><br><span class="line">1234567891011121314</span><br></pre></td></tr></table></figure>

<p>总结一下div相关：</p>
<ul>
<li>div后面跟的是除数</li>
<li>被除数位数是除数两倍</li>
<li>被除数存在ax中或ax+dx（ax低，dx高）</li>
<li>商在ax或al中，余数在ah或dx中（高余数，低商）</li>
</ul>
<h5 id="dup"><a href="#dup" class="headerlink" title="dup"></a><strong>dup</strong></h5><p>dup是一个操作符，由编译器识别，和db,dw,dd配合使用，如：</p>
<p>db 3 dup (0)表示定义了三个值是0的字节，等价于db 0,0,0</p>
<p>db 3 dup (1,2,3)等价于db 1,2,3,1,2,3,1,2,3 共九个字节</p>
<p>db 3 dup (‘abc’,‘ABC’)等价于db ‘abcABCabcABCabcABC’</p>
<p>综上，db|dw|dd 重复次数 dup (重复内容)</p>
<h3 id="转移指令原理"><a href="#转移指令原理" class="headerlink" title="转移指令原理"></a>转移指令原理</h3><h5 id="转移指令"><a href="#转移指令" class="headerlink" title="转移指令"></a><strong>转移指令</strong></h5><p>可以修改IP或同时修改CS，IP的系统指令称为转移指令，可分为以下几类：</p>
<ul>
<li>转移行为：<ul>
<li>只修改IP，称为段内转移，如jmp ax</li>
<li>同时修改CS和IP，称为段间转移，如jmp 1000:0</li>
</ul>
</li>
<li>修改范围（段内转移）：<ul>
<li>短转移：修改IP范围-128~127</li>
<li>近转移：修改IP范围-32768~32767</li>
</ul>
</li>
<li>转移指令分类：<ul>
<li>无条件转移：jmp</li>
<li>条件转移</li>
<li>循环指令</li>
<li>过程</li>
<li>中断</li>
</ul>
</li>
</ul>
<h5 id="offset操作符"><a href="#offset操作符" class="headerlink" title="offset操作符"></a><strong>offset操作符</strong></h5><p>offset是由编译器处理的符号，它能去的标号的偏移地址，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start:mov ax,offset start</span><br><span class="line">s:mov ax,offset s</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>这里就是将start和s的偏移地址分别送给ax，也就是0和3</p>
<h5 id="jmp指令"><a href="#jmp指令" class="headerlink" title="jmp指令"></a><strong>jmp指令</strong></h5><p>jmp是无条件转移指令，可以只修改IP也可以同时修改CS和IP，只要给出两种信息，要转移的目的地址和专一的距离。</p>
<p>依据位移的jmp指令：jmp short 标号（转到标号处执行指令）。这个指令实现的是段内短转移，对IP修改范围是-128~127，指令结束后CS:IP指向标号的地址，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0BBD:0000   start:mov ax,0  (B80000)</span><br><span class="line">0BBD:0003   jmp short s   (EB03)</span><br><span class="line">0BBD:0005   add ax,1    (050100)</span><br><span class="line">0BBD:0008   s:inc ax    (40)</span><br><span class="line">1234</span><br></pre></td></tr></table></figure>

<p>执行之后ax值为1，因为跳过了add指令。</p>
<p>还应注意的是，jmp short短转移指令并不会在机器码中直接写明需要转移的地址（0BBD:0008）,jmp的机器码是EB03并没有包含转移的地址，这里的转移距离是相对计算而出的地址，来看下面的执行过程：</p>
<ol>
<li>(CS)=0BBDH,(IP)=0006H，CS:IP指向EB03（jmp short s）</li>
<li>读取指令EB03进入指令缓冲器</li>
<li>(IP)=(IP)+指令长度，即(IP)=(IP)+2=0008H，之后CS:IP指向add ax,1</li>
<li>CPU指向指令缓冲器中的指令EB03</li>
<li>执行之后(IP)=000BH，指向inc ax</li>
</ol>
<p>在jmp short s的机器码中，包含的并不是转移的地址，而是转移的位移，这里的位移是相对计算出来的，用8位一字节来表示，所以表示范围是-128<del>127，用补码表示。计算方法如是，8位位移=标号处地址-jmp下一条指令的地址。当然还有一种类似的指令是jmp near ptr 标号，是近转移，原理一样，只是表示位移的是字类型16位，表示范围-32768</del>32767。</p>
<h5 id="jmp-地址远转移"><a href="#jmp-地址远转移" class="headerlink" title="jmp+地址远转移"></a><strong>jmp+地址远转移</strong></h5><p>jmp far ptr 标号实现的是段间转移，也就是远转移，它的机器码中指明了转移的目的地址的CS和IP的值，如下面例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0BBD:0000   start:mov ax,0    (B80000)</span><br><span class="line">0BBD:0003   mov bx,0    (BB0000)</span><br><span class="line">0BBD:0006   jmp far ptr s    (EA0B01BD0B)</span><br><span class="line">0BBD:000B   db 256 dup (0)    </span><br><span class="line">0BBD:010B   s:add ax,1    </span><br><span class="line">0BBD:010X   inc ax</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>

<p>可以看出，jmp的机器码中明确指明了跳转位置s的地址0BBD:010B，在低位的是IP的值，高位的是CS的值。</p>
<h5 id="jmp-寄存器-内存转移"><a href="#jmp-寄存器-内存转移" class="headerlink" title="jmp+寄存器|内存转移"></a><strong>jmp+寄存器|内存转移</strong></h5><p>jmp+寄存器：jmp 16位reg，实现的是(IP)=(16位reg)，之前讨论过，直接修改IP的值为寄存器中的值。</p>
<p>jmp+内存：jmp加内存使用的时候有两种用法：</p>
<ul>
<li>jmp word ptr 内存单元地址（段内转移）<ul>
<li>从内存单元地址处开始存放一个座位转移目的的偏移地址的字</li>
<li>内存单元支持任何寻址方式</li>
<li>如jmp word ptr ds:[0]，执行后(IP)=0123H(ds:[0]中的值是123H)</li>
</ul>
</li>
<li>jmp dword ptr 内存单元地址（段间转移）<ul>
<li>从内存单元地址处开始存放两个字，高位存放段地址，低位偏移地址作为转移的目的地址</li>
<li>(CS)=(内存单元地址+2),(IP)=(内存单元地址)，支持任一种寻址方式</li>
<li>如jmp dword ptr [bx]跳转到0:123H</li>
</ul>
</li>
</ul>
<h5 id="jcxz指令"><a href="#jcxz指令" class="headerlink" title="jcxz指令"></a><strong>jcxz指令</strong></h5><p>jcxz指令为条件转移指令，所有的条件转移指令都是短转移，转移范围是-128~127。使用格式是jcxz 标号，功能是如果(cx)=0则跳转到标号处执行；如果(cx)!=0，那么什么也不做继续执行代码。</p>
<h5 id="loop指令-1"><a href="#loop指令-1" class="headerlink" title="loop指令"></a><strong>loop指令</strong></h5><p>loop为循环指令，所有的循环指令都是短转移，转移范围是-128~127。使用格式是loop 标号，功能是如果(cx)!=0那么跳转到标号处执行；如果(cx)=0那么什么也不做继续执行程序。</p>
<h5 id="根据位移进行转移的指令总结"><a href="#根据位移进行转移的指令总结" class="headerlink" title="根据位移进行转移的指令总结"></a><strong>根据位移进行转移的指令总结</strong></h5><p>下面几条指令是根据位移进行转移（相对计算转移位置，而不是直接提供转移目的的IP和CS的值）</p>
<ul>
<li>jmp short 标号</li>
<li>jmp near ptr 标号</li>
<li>jcxz 标号</li>
<li>loop 标号</li>
</ul>
<p>这些指令之所以是间接计算标号的位置，是为了方便在代码中浮动装配，使得循环体或这些指令的代码段在任何位置都可以执行（不要超跳转范围）。而编译器会对跳转的范围进行检测，如果跳转超过了范围，编译器会报错。</p>
<p>注：jmp 2100:0是debug使用的汇编指令，编译器并不认识。</p>
<h3 id="call和ret指令"><a href="#call和ret指令" class="headerlink" title="call和ret指令"></a>call和ret指令</h3><h5 id="ret和retf"><a href="#ret和retf" class="headerlink" title="ret和retf"></a><strong>ret和retf</strong></h5><p>ret和call都是转移指令，都是修改IP的值，或同时修改CS和IP。</p>
<p>ret指令用栈中的数据修改IP，实现的是近转移；retf指令用栈中的数据修改CS和IP的值，实现远转移。格式：直接用 ret。</p>
<p>ret执行步骤：</p>
<ol>
<li>(IP)=((SS)*16+(SP))</li>
<li>(SP)=(SP)+2</li>
</ol>
<p>retf执行步骤：</p>
<ol>
<li>(IP)=((SS)*16+(SP))</li>
<li>(SP)=(SP)+2</li>
<li>(CS)=((SS)*16+(SP))</li>
<li>(SP)=(SP)+2</li>
</ol>
<p>所以ret指令相当于 pop ip，执行retf指令相当于执行pop ip,pop cs。</p>
<h5 id="call指令"><a href="#call指令" class="headerlink" title="call指令"></a><strong>call指令</strong></h5><p>call指令也是一个转移指令，执行格式：call 目标（具体使用接下来说明），call的执行步骤：</p>
<ol>
<li>将当前的IP或CS和IP入栈</li>
<li>转移</li>
</ol>
<p>call不能实现短转移，但它实现转移的原理和jmp相同。</p>
<p>根据位移转移：call 标号，近转移，16位转移范围，也是使用相对的转移地址。</p>
<p>执行步骤：</p>
<ol>
<li>(SP)=(SP)-2</li>
<li>((SS)*16+(SP))=(IP)</li>
<li>(IP)=(IP)+16</li>
</ol>
<p>所以执行这条命令相当于执行push ip,jmp near ptr 标号。</p>
<p>直接使用地址进行（远）转移：call far ptr 标号，执行步骤：</p>
<ol>
<li>(SP)=(SP)-2</li>
<li>((SS)*16+(SP))=(CS)</li>
<li>(SP)=(SP)-2</li>
<li>((SS)*16+(SP))=(IP)</li>
<li>(CS)=标号所在的段的段地址</li>
<li>(IP)=标号的偏移地址</li>
</ol>
<p>所以执行call far ptr 标号相当于执行push cs,push ip,jmp far ptr 标号</p>
<p>使用寄存器的值作为call的跳转地址：call 16位reg</p>
<ol>
<li>(SP)=(SP)-2</li>
<li>((SS)*16+(SP))=(IP)</li>
<li>(IP)=(16为reg)</li>
</ol>
<p>相当于执行push ip,jmp 16位reg</p>
<p>使用内存中的值作为call的跳转地址：call word ptr 内存单元地址，当然还有call dword ptr 内存单元地址，这样进行的就是远转移。</p>
<h5 id="联合使用ret和call"><a href="#联合使用ret和call" class="headerlink" title="联合使用ret和call"></a><strong>联合使用ret和call</strong></h5><p>联合使用ret和call实现子程序的框架：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line">main:</span><br><span class="line">···</span><br><span class="line">call sub1</span><br><span class="line">···</span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">sub1:</span><br><span class="line">···</span><br><span class="line">call sub2</span><br><span class="line">···</span><br><span class="line">ret</span><br><span class="line"></span><br><span class="line">sub2:</span><br><span class="line">···</span><br><span class="line">ret</span><br><span class="line">code ends</span><br><span class="line">end main</span><br><span class="line">1234567891011121314151617181920</span><br></pre></td></tr></table></figure>

<h5 id="mul指令"><a href="#mul指令" class="headerlink" title="mul指令"></a><strong>mul指令</strong></h5><p>mul是乘法指令，使用时应注意，两个相乘的数，要么都是8位，要么都是16位，如果是8位，那么其中一个默认放在al中，另一个在一个8位reg或字节内存单元中；若是16位，则一个默认在ax中，另一个在16位reg或字内存单元中。如果是8位乘法， 则结果放在ax中，结果是16位；若是16位乘法，结果默认在ax和dx中，dx高位，ax低位，共32位。</p>
<p>格式：mul reg 或 mul 内存单元，支持内存单元的各种寻址方式。</p>
<p>如mul word ptr [bx+si+8]代表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(ax)&#x3D;(ax)*((ds)*16+(bx)+(si)+8)低16位</span><br><span class="line">(dx)&#x3D;(ax)*((ds)*16+(bx)+(si)+8)高16位</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>例：计算100*10</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov al,100</span><br><span class="line">mov bl,10</span><br><span class="line">mul bl</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<h5 id="参数的传递和模块化编程"><a href="#参数的传递和模块化编程" class="headerlink" title="参数的传递和模块化编程"></a><strong>参数的传递和模块化编程</strong></h5><p>看下面一段程序：计算data中第一行的数的立方存在第二行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">data segment</span><br><span class="line">dw 1,2,3,4,5,6,7,8</span><br><span class="line">dd 0,0,0,0,0,0,0,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:mov ax,data</span><br><span class="line">mov ds,ax</span><br><span class="line">mov si,0</span><br><span class="line">mov di,16</span><br><span class="line"></span><br><span class="line">mov cs,8</span><br><span class="line">s:mov bx,[si]</span><br><span class="line">call cube</span><br><span class="line">mov [di],ax</span><br><span class="line">mov [di].2,dx</span><br><span class="line">add si,2</span><br><span class="line">add di,4</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">cube:mov ax,bx</span><br><span class="line">mul bx</span><br><span class="line">mul bx</span><br><span class="line">ret</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">12345678910111213141516171819202122232425262728293031</span><br></pre></td></tr></table></figure>

<h5 id="寄存器冲突"><a href="#寄存器冲突" class="headerlink" title="寄存器冲突"></a><strong>寄存器冲突</strong></h5><p>观察下面将data中的数据全转化为大写的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">data segment</span><br><span class="line">db &#39;word&#39;,0</span><br><span class="line">db &#39;unix&#39;,0</span><br><span class="line">db &#39;wind&#39;,0</span><br><span class="line">db &#39;good&#39;,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:mov ax,data</span><br><span class="line">mov ds,ax</span><br><span class="line">mov bx,0</span><br><span class="line"></span><br><span class="line">mov cx,4</span><br><span class="line">s:mov si,bx</span><br><span class="line">call capital</span><br><span class="line">add bx,5</span><br><span class="line">loop s</span><br><span class="line"></span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">capital:mov cl,[si]</span><br><span class="line">mov ch,0</span><br><span class="line">jcxz ok</span><br><span class="line">and byte ptr [si],11011111b</span><br><span class="line">inc si</span><br><span class="line">jmp short capital</span><br><span class="line">ok:ret</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">12345678910111213141516171819202122232425262728293031</span><br></pre></td></tr></table></figure>

<p>这段代码有一个问题出在，主函数部分使用cx设置循环次数4次，在循环中调用了子函数，而子函数中有一个判断语句jcxz也是用了cx，并且在之前修改了cx的值，造成逻辑错误。虽然修改的方法有很多，但我们应遵循以下的标准：</p>
<ul>
<li>编写调用子程序的程序不必关心子程序使用了什么寄存器</li>
<li>编写子程序不用关心调用子程序的程序使用了什么寄存器</li>
<li>不会发生寄存器冲突</li>
</ul>
<p>针对这三点，我们可以如下修改代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">capital:push cx</span><br><span class="line">push si</span><br><span class="line"></span><br><span class="line">change:mov cl,[si]</span><br><span class="line">mov ch,0</span><br><span class="line">jcxz ok</span><br><span class="line">and byte ptr [si],11011111b</span><br><span class="line">inc si</span><br><span class="line">jmp short change</span><br><span class="line"></span><br><span class="line">ok:pop si</span><br><span class="line">pop cx</span><br><span class="line">ret</span><br><span class="line">···</span><br><span class="line">123456789101112131415</span><br></pre></td></tr></table></figure>

<p>虽然和上面的程序中没有冲突的是si，但我们保险起见，在子程序开始时将子程序用到的所有的寄存器的内容存入栈中，在返回之前在出栈回到相应寄存器中。这样无论调用子程序的程序使用了什么寄存器，都不会产生寄存器冲突。</p>
<h3 id="标志寄存器"><a href="#标志寄存器" class="headerlink" title="标志寄存器"></a>标志寄存器</h3><h5 id="标志寄存器-1"><a href="#标志寄存器-1" class="headerlink" title="标志寄存器"></a><strong>标志寄存器</strong></h5><p>CPU中有一种特殊的寄存器——标志寄存器（不同CPU中的个数和结构都可能不同），主要有以下三种作用：</p>
<ol>
<li>存储相关指令的某些执行结果</li>
<li>为CPU执行相关质量提供行为依据</li>
<li>控制CPU相关工作方式</li>
</ol>
<p>8086CPU中的标志寄存器有16位，其中存储的信息通常被称为程序状态字（PSW），标志寄存器以下简称为flag。标志位如图：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">15	14	13	12	11	10	9	8	7	6	5	4	3	2	1	0</span><br><span class="line">				OF	DF	IF	TF	SF	ZF		AF		PF		CF</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>如上图所示，1,3,5,12,13,14,15位没有使用，没有任何意义，而其他几位都有不同的含义。</p>
<h5 id="ZF标志"><a href="#ZF标志" class="headerlink" title="ZF标志"></a><strong>ZF标志</strong></h5><p>ZF位于flag第6位，零标志位，功能是记录相关指令执行后结果是否为0，如果结果为0，则ZF=1，否则ZF=0。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov ax,1</span><br><span class="line">sub ax,1</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>执行后结果为0，ZF=1。一般情况下，运算指令（如add,sub,mul,div,inc,or,and）影响标志寄存器，而传送指令（如mov,push,pop）不影响标志寄存器。</p>
<h5 id="PF标志"><a href="#PF标志" class="headerlink" title="PF标志"></a><strong>PF标志</strong></h5><p>flag的第2位是PF标志位，奇偶标志位，功能是记录相关指令执行后，其结果的所有bit中1的个数是否为偶数，若1的个数是偶数，pf=1，如果是奇数，fp=0。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov al,1</span><br><span class="line">add al,10</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>执行后结果为00001011b，有3个1，所以PF=0。</p>
<h5 id="SF标志"><a href="#SF标志" class="headerlink" title="SF标志"></a><strong>SF标志</strong></h5><p>flag的第7位是SF标志位，符号标志位，它记录相关指令执行后，结果是否为负，如果结果为负，则sf=1，结果为正，sf=0。计算机中通常用补码表示数据，一个数可以看成有符号数或无符号数，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00000001B，可以看成无符号1或有符号+1</span><br><span class="line">10000001B，可以看成无符号129或有符号-127</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>也就是说对于同一个数字，可以当做有符号数运算也可以当做无符号数运算。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov al,10000001b</span><br><span class="line">add al,1</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>这段代码结果是(al)=10000010b，可以将add指令进行的运算当做无符号运算，那么相当于129+1=130，也可以当做有符号运算，相当于-127+1=-126。SF标志就是在进行有符号运算的时候记录结果的符号的，当进行无符号运算的时候SF无意义（但还会影响SF，只是对我们来说没有意义了）。</p>
<h5 id="CF标志"><a href="#CF标志" class="headerlink" title="CF标志"></a><strong>CF标志</strong></h5><p>flag的第0位是CF标志位，进位标志位，一般情况下载进行无符号运算时，他记录了运算结果的最高有效为向更高为的进位值，或从更高位的借位值。加入一个无符号数据是8位的，也就是0-7个位，那么在做加法的时候就可能造成进位到第8位，这时并不是丢弃这个进位，而是记录在falg的CF位上。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov al,98h</span><br><span class="line">add al,al</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>执行后al=30h，CF=1。当两个数据做减法的时候有可能向更高位借位，如97h-98h借位后相当于197h-198h，CF也可以用来记录借位，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov al,97h</span><br><span class="line">sub al,98h</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>执行后(al)=FFH，CF=1记录了向更高位借位的信息。</p>
<h5 id="OF标志"><a href="#OF标志" class="headerlink" title="OF标志"></a><strong>OF标志</strong></h5><p>在进行有符号运算的时候，如果结果超过了机器能表示的范围称为“溢出”。机器能表示的范围是指如8位寄存器存放或一个内存单元存放，表示范围就是-128~127,16位同理。如果超出了这个范围就叫做溢出，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov al,98</span><br><span class="line">add al,99</span><br><span class="line"></span><br><span class="line">mov al,0F0H</span><br><span class="line">add al,088H</span><br><span class="line">12345</span><br></pre></td></tr></table></figure>

<p>第一段代码(al)=(al)+99=98+99=197超过了8位能表示的有符号数的范围，第二段代码结果(al)=(al)+(-120)=(-16)+(-12-)=-136也超过了8位有符号的范围，所以计算的结果是不可信的。如第一段代码计算之后(al)=0C5H，换成补码表示的是-59,98+99=-59很明显是不正确的结果。</p>
<p>flag的第11位是OF标志位，溢出标志位，一般情况下，OF记录有符号数运算结果是否溢出，如果溢出则OF=1，如果没有溢出，OF=0。所以CF是对无符号数的标志，OF是对有符号的标志。但对于一个运算指令，他们是同时生效的，只不过这个指令究竟是有符号还是无符号，是看实际的操作的。有符号CF无意义，无符号OF无意义。</p>
<h5 id="adc指令"><a href="#adc指令" class="headerlink" title="adc指令"></a><strong>adc指令</strong></h5><p>adc是带进位加法指令，利用了CF标志位上记录的进位值。格式：adc 操作对象1,操作对象2。功能：操作对象1=操作对象1+操作对象2+CF。如abc ax,bx实现的是(ax)=(ax)+(bx)+CF，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov ax,2</span><br><span class="line">mov bx,1</span><br><span class="line">sub bx,ax</span><br><span class="line">adc ax,1</span><br><span class="line">1234</span><br></pre></td></tr></table></figure>

<p>注意这段代码，首先ax中的值是2，bx中的值是1，然后进行(bx)-(ax)的计算，结果是-1造成了无符号的借位，此时CF=1，在进行adc ax,1时，进行的是(ax)+1+CF=2+1+1=4。仔细分析一下就可以发现，如果把整个加法分开，低位先相加，然后高位相加再加上进位CF， 就是一个完整的加法运算，也就是说add ax,dx这个指令可以拆分为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add al,bl</span><br><span class="line">adc ah,bh</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>所以有了adc这个指令我们就可以完成一些更庞大的数据量的加法运算。如计算1EF000H+000H的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov ax,001eh</span><br><span class="line">mov bx,0f000h</span><br><span class="line">add bx,1000h</span><br><span class="line">adc ax,0020h</span><br><span class="line">1234</span><br></pre></td></tr></table></figure>

<p>注：inc和loop指令不影响CF位。</p>
<h5 id="sbb指令"><a href="#sbb指令" class="headerlink" title="sbb指令"></a><strong>sbb指令</strong></h5><p>sbb和adc类似，是带借位的减法，格式：sbb 操作对象1,操作对象2，执行的功能是操作对象1=操作对象1-操作对象2-CF，如：sbb ax,bx即(ax)=(ax)-(bx)-CF。sbb指令影响CF。</p>
<h5 id="cmp指令"><a href="#cmp指令" class="headerlink" title="cmp指令"></a><strong>cmp指令</strong></h5><p>cmp是比较指令，cmp的功能相当于减法，只是不保存结果。cmp执行后影响标志寄存器，其他相关指令通过识别被影响的标志位来得知结果。格式：cmp 操作对象1,操作对象2，执行功能是计算对操作对象1-操作对象2但不保存结果，仅仅根据结果对标志位进行设置，如：cmp ax,ax结果为0，但并不保存在ax中，执行之后zf=1,pf=1,sf=0,cf=0,of=0。若执行cmp ax,bx通过标志位就可以判断结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">若(ax)&#x3D;(bx)则(ax)-(bx)&#x3D;0,zf&#x3D;1</span><br><span class="line">若(ax)!&#x3D;(bx)则(ax)-(bx)!&#x3D;0,zf&#x3D;0</span><br><span class="line">若(ax)&lt;(bx)则(ax)-(bx)产生借位,cf&#x3D;1</span><br><span class="line">若(ax)&gt;&#x3D;(bx)则(ax)-(bx)不产生借位,cf&#x3D;0</span><br><span class="line">若(ax)&gt;(bx)则(ax)-(bx)既不产生借位,结果又不为0,cf&#x3D;0且zf&#x3D;0</span><br><span class="line">若(ax)&lt;&#x3D;(bx)则(ax)-(bx)既可能借位,结果可能为0,cf&#x3D;1或zf&#x3D;1</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>

<p>但实际上往往会出现溢出，如34-(-96)=82H(82H是-126的补码)，但应该等于130超出了补码表示的范围，所以sf=1。我们可以同时检验sf和of两个来验证cmp的结果：cmp ah,bh</p>
<ul>
<li>若sf=1，of=0说明没有溢出，那么sf的计算结果正确(ah)&lt;(bh)</li>
<li>若sf=1，of=1说明出现了溢出，那么sf结果相反(ah)&gt;(bh)</li>
<li>若sf=0，of=1说明有溢出，那么sf结果相反(ah)&lt;(bh)</li>
<li>若sf=0，of=0说明没有溢出，那么结果正确(ah)&gt;=(bh)</li>
</ul>
<h5 id="检测比较结果的条件转移指令"><a href="#检测比较结果的条件转移指令" class="headerlink" title="检测比较结果的条件转移指令"></a><strong>检测比较结果的条件转移指令</strong></h5><p>下面几条指令和cmp一起使用，检测不同的标志位来达到不同的条件跳转效果：</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>含义</th>
<th>检测的标志位</th>
</tr>
</thead>
<tbody><tr>
<td>je</td>
<td>等于则转移</td>
<td>zf=1</td>
</tr>
<tr>
<td>jne</td>
<td>不等于转移</td>
<td>zf=0</td>
</tr>
<tr>
<td>jb</td>
<td>小于转移</td>
<td>cf=1</td>
</tr>
<tr>
<td>jnb</td>
<td>不小于转移</td>
<td>cf=0</td>
</tr>
<tr>
<td>ja</td>
<td>大于转移</td>
<td>cf=0且zf=0</td>
</tr>
<tr>
<td>jna</td>
<td>不大于转移</td>
<td>cf=1或zf=1</td>
</tr>
</tbody></table>
<p>指令中的字母含义如下：</p>
<ul>
<li>e:equa;</li>
<li>ne:not equal</li>
<li>b:below</li>
<li>nb:not below</li>
<li>a:above</li>
<li>na:not above</li>
</ul>
<p>上面的检测都是在cmp进行无符号比较时的检测位，有符号数检测原理一样，只是检测的标志位不同而已。下面看一个例子，如果(ah)=(bh)则(ah)=(ah)+(ah)，否则(ah)=(ah)+(bh)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmp ah,bh</span><br><span class="line">je s</span><br><span class="line">add ab,bh</span><br><span class="line">jmp short ok</span><br><span class="line">s:add ah,ah</span><br><span class="line">ok:···</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>

<p>这里注意的是，je检测的是zf位，而不管之前执行的是什么指令，只要zf=1就会发生转移，所以cmp的位置需要仔细的把控，当然是否和cmp配合使用也是取决于编程者，下面例子实现了统计data中数值为8的字节个数，然后用ax保存：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">data segment</span><br><span class="line">db 8,11,8,1,8,5,63,38</span><br><span class="line">data ends</span><br><span class="line">···</span><br><span class="line">mov ax,data</span><br><span class="line">mov ds,ax</span><br><span class="line">mov bx,0</span><br><span class="line">mov ax,0</span><br><span class="line">mov cx,8</span><br><span class="line">s:cmp byte ptr [bx],8</span><br><span class="line">jne next</span><br><span class="line">inc ax</span><br><span class="line">next:inc bx</span><br><span class="line">loop s</span><br><span class="line">···</span><br><span class="line">12345678910111213141516</span><br></pre></td></tr></table></figure>

<h5 id="DF标志位和串传送指令"><a href="#DF标志位和串传送指令" class="headerlink" title="DF标志位和串传送指令"></a><strong>DF标志位和串传送指令</strong></h5><p>flag的第10位是DF标志位，方向标志位，在串处理中，每次操作si，di的增减。</p>
<ul>
<li>df=0每次操作后si，di递增</li>
<li>df=1每次操作后si，di递减</li>
</ul>
<p>串传送指令，movsb，这个指令相当于执行：</p>
<ol>
<li><p><code>((es)*16+(di))=((ds)*16+(si))</code></p>
</li>
<li><p>如果df=0：(si)=(si)+1,(di)=(di)+1</p>
<p>如果df=1：(si)=(si)-1,(di)=(di)-1</p>
</li>
</ol>
<p>可以看出，movsb是将DS:SI指向的内存单元中的字节送入ES:DI中，然后根据DF的值对SI和DI增减1</p>
<p>同理mobsw就是将DS:SI指向的内存单元中的字送入ES:DI中，然后根据DF的值对SI和DI增减2</p>
<p>但一般来说，movsb和movsw都是和rep联合使用的，格式：rep movsb，这相当于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s:movsb</span><br><span class="line">loop s</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>所以rep的作用是根据cx的值重复执行后面的串传送指令，由于每次执行movsb之后si和di都会自行增减，所以使用rep可以完成(cx)个字节的传送。movsw也一样。</p>
<p>由于DF位决定着串传送的方向，所以这里有两条指令用来设置df的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cld：df&#x3D;0</span><br><span class="line">std：df&#x3D;1</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>例子：使用串传送指令将data段中第一个字符串复制到他后面的空间中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">data segment</span><br><span class="line">db &#39;Welcome to masm!&#39;</span><br><span class="line">db 16 dup (0)</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">mov ax,data</span><br><span class="line">mov ds,ax</span><br><span class="line">mov si,0</span><br><span class="line">mov es,ax</span><br><span class="line">mov di,16</span><br><span class="line">mov cx,16</span><br><span class="line">cld</span><br><span class="line">rep movsb</span><br><span class="line">···</span><br><span class="line">123456789101112131415</span><br></pre></td></tr></table></figure>

<h5 id="pushf和popf"><a href="#pushf和popf" class="headerlink" title="pushf和popf"></a><strong>pushf和popf</strong></h5><p>pushf的功能是将标志寄存器的值入栈，popf是出栈标志寄存器。有了这两个命令，就可以直接访问标志寄存器了，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov ax,0</span><br><span class="line">push ax</span><br><span class="line">popf</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<h5 id="标志寄存器在Debug中的表示"><a href="#标志寄存器在Debug中的表示" class="headerlink" title="标志寄存器在Debug中的表示"></a><strong>标志寄存器在Debug中的表示</strong></h5><p>Debug中-r查看寄存器信息，最后有一段表示，下面列出我们已知的寄存器在Debug里的表示：</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>值1的标记</th>
<th>值0的标记</th>
</tr>
</thead>
<tbody><tr>
<td>of</td>
<td>OV</td>
<td>NV</td>
</tr>
<tr>
<td>sf</td>
<td>NG</td>
<td>PL</td>
</tr>
<tr>
<td>zf</td>
<td>ZR</td>
<td>NZ</td>
</tr>
<tr>
<td>pf</td>
<td>PE</td>
<td>PO</td>
</tr>
<tr>
<td>cf</td>
<td>CY</td>
<td>NC</td>
</tr>
<tr>
<td>df</td>
<td>DN</td>
<td>UP</td>
</tr>
</tbody></table>
<h3 id="内中断"><a href="#内中断" class="headerlink" title="内中断"></a>内中断</h3><h5 id="内中断的产生"><a href="#内中断的产生" class="headerlink" title="内中断的产生"></a><strong>内中断的产生</strong></h5><p>任何一个通用CPU都拥有执行完当前正在执行的指令后，检测到从CPU发来的中断信息，然后立即去处理中断信息的能力。这里的中断信息是指几个具有先后顺序的硬件操作，当CPU出现下面请看时会产生中断信息，相应的中断信息类型码（供CPU区分来源，是字节型，共256种）如下：</p>
<ul>
<li>除法错误，如执行div指令出现除法溢出 0</li>
<li>单步执行 1</li>
<li>执行into指令 4</li>
<li>执行int指令 指令执行的int n后面的n就是一个字节型立即数，即为中断类型码</li>
</ul>
<h5 id="中断处理和中断向量表"><a href="#中断处理和中断向量表" class="headerlink" title="中断处理和中断向量表"></a><strong>中断处理</strong>和中断向量表</h5><p>CPU接收到中断信息之后，往往要对中断信息进行处理，而如何处理使我们编程决定的。而CPU通过中断向量表来根据中断类型找到处理程序的入口地址（CS:IP)也称为中断向量。</p>
<p>中断向量表中存放着不同的中断类型对应的中断向量（处理程序的入口地址），中断向量表存放在内存中，8086PC指定必须放在内存地址0处，从0000:0000到0000:03FF的1024个单元存放中断向量表，每个表项占两个字，四个字节。</p>
<p>CPU会自动根据中断类型找到对应的中断向量并设置CS和IP的值，这个过程称为中断过程，步骤如下：</p>
<ol>
<li>（从中断信息中）取得中断类型码</li>
<li>标志寄存器的值入栈（暂存）pushf</li>
<li>设置标志寄存器第8位TF和第9位IF的值为0 TF=0,IF=0</li>
<li>CS内容入栈 push cs</li>
<li>IP内容入栈 push ip</li>
<li>在中断向量表中找到对应的CS和IP值并设置 <code>(ip)=(N*4),(cs)=(N*4+2)</code></li>
</ol>
<p>这么做的目的是，在中断处理之后还要回复CPU的现场（各个寄存器的值），所以先把那些入栈。</p>
<h5 id="中断处理程序和iret指令"><a href="#中断处理程序和iret指令" class="headerlink" title="中断处理程序和iret指令"></a><strong>中断处理程序和iret指令</strong></h5><p>运行中的CPU随时都可能接收到中断信息，所以CPU随时都可能执行中断程序，执行的步骤：</p>
<ol>
<li>保存用到的寄存器</li>
<li>处理中断</li>
<li>回复用到的寄存器</li>
<li>用iret返回</li>
</ol>
<p>iret的指令功能是：pop ip pop cs popf(前面说到了，这三个寄存器的入栈是硬件自动完成的，所以iret是和硬件自动完成的步骤配合使用的)。</p>
<p>以处理0号除法溢出中断为例，我们想要编写除法溢出的中断处理程序需要解决如下几步问题：</p>
<ol>
<li>编写程序</li>
<li>找到一段没有使用的内存空间</li>
<li>将程序写入到内存</li>
<li>将内存中的程序的入口写入0号中断的向量表位置</li>
</ol>
<p>我们可以采取下面框架来完成这个过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">start do0安装程序</span><br><span class="line">设置中断向量表</span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">do0 程序部分</span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line">···</span><br><span class="line">12345678910</span><br></pre></td></tr></table></figure>

<p>可以看出我们分成了两部分，第一部分称之为“安装”，第二部分是代码实现。安装部分的函数实现思路如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">设置es:di至项目的地址</span><br><span class="line">设置ds:si指向源地址</span><br><span class="line">设置cx为传输长度</span><br><span class="line">设置传输方向为正</span><br><span class="line">rep movsb</span><br><span class="line">设置中断向量表</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>

<p>实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">start:mov ax,cs</span><br><span class="line">mov ds,ax</span><br><span class="line">mov si,offset do0</span><br><span class="line">mov ax,0</span><br><span class="line">es,ax</span><br><span class="line">mov di,200h</span><br><span class="line">mov cx,offset do0end-fooset do0</span><br><span class="line">cld</span><br><span class="line">rep movsb</span><br><span class="line">···</span><br><span class="line">do0:代码</span><br><span class="line">do0end:nop</span><br><span class="line">123456789101112</span><br></pre></td></tr></table></figure>

<p>这里offset do0end-fooset do0的意思是do0到do0end的代码长度，-是编译器可以识别并运算的符号，也就是说编译器可以再编译时处理表达式，如8-4等。还要注意的是，假如代码部分要输出“owerflow！”的话，需要将输出的内容写在代码部分并写入选择的内存中，否则如果单单在这个安装程序开始开辟一段data段的话，是会在程序返回时被释放。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">do0:jmp short do0start</span><br><span class="line">db &quot;overflow!&quot;</span><br><span class="line"></span><br><span class="line">do0start:</span><br><span class="line">···</span><br><span class="line">do0end:nop</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>

<h5 id="单步中断"><a href="#单步中断" class="headerlink" title="单步中断"></a><strong>单步中断</strong></h5><p>当标志寄存器的TF标志位为1的时候，CPU会在执行一条语句之后将资源入栈，然后去执行单步中断处理程序，如Debug就是运行在单步中断的条件下的，它能让CPU每执行一条指令都暂停，然后我们可以查看CPU的状态。但CPU可以防止在运行单步中断处理程序的时候再发生中断然后又去调用单步中断处理程序…CPU可以将TF置零，这样就不会再中断了。CPU提供这个功能就是为了单步跟踪程序的执行。</p>
<p>但需要注意的是，CPU并不会每次接收中断信息之后立即执行，在某些特定情况下它不会立即响应中断，如设置ss寄存器的时候如果接收到了中断信息，就不会响应。因为我们需要连续设置ss和ip的值，在debug中单步执行的时候也是，mov ss,ax和mov sp,0是在一步之内执行的，所以我们需要灵活使用这个特性，sp紧跟着ss执行，而不要在设置ss和sp之间插入其他指令。</p>
<h3 id="int指令"><a href="#int指令" class="headerlink" title="int指令"></a>int指令</h3><h5 id="int指令-1"><a href="#int指令-1" class="headerlink" title="int指令"></a><strong>int指令</strong></h5><p>int指令也会引发中断，使用格式是int n，n就是int引发的中断类型码，int中断的执行过程：</p>
<ol>
<li>获取类型码n</li>
<li>标志寄存器入栈，if=0，tf=0</li>
<li>cs，ip入栈</li>
<li><code>(ip)=(n*4),(cs)=(n*4+2)</code></li>
<li>执行n号中断的程序</li>
</ol>
<p>所以我们可以使用int指令调用任何一个中断的中断程序，如int 0调用除法溢出中断。一般情况下，系统将一些具有一定功能的小程序以中断的方式提供给程序调用，当然也可以自己编写，可以简称为中断例程。</p>
<h5 id="编写中断例程"><a href="#编写中断例程" class="headerlink" title="编写中断例程"></a><strong>编写中断例程</strong></h5><p>如编写中断7ch的中断例程，实现word型数据的平方，返回dx和ax中。求2*3456^2，代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line">start mov ax,3456</span><br><span class="line">int 7ch</span><br><span class="line">add ax,ax</span><br><span class="line">adc dx,dx</span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">12345678910</span><br></pre></td></tr></table></figure>

<p>接下来写7ch的功能和安装程序，并修改7ch中断向量表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line">start:mov ax,cs</span><br><span class="line">mov ds,ax</span><br><span class="line">mov si,offset sqr</span><br><span class="line">mov ax,0</span><br><span class="line">mov es,ax</span><br><span class="line">mov di,200h</span><br><span class="line">mov cx,offset sqrend-offset sqr</span><br><span class="line">cld</span><br><span class="line">rep movsb</span><br><span class="line"></span><br><span class="line">mov ax,0</span><br><span class="line">mov es,ax</span><br><span class="line">mov word ptr es:[7ch*4],200h</span><br><span class="line">mov word ptr es:[7ch*4+2],0</span><br><span class="line"></span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">sqr:mul ax</span><br><span class="line">iret</span><br><span class="line"></span><br><span class="line">sqrend:nop</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">1234567891011121314151617181920212223242526</span><br></pre></td></tr></table></figure>

<p>编写7ch中断实现loop指令，主程序输出80个“！”：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">start mov ax,0b800h</span><br><span class="line">mov es,ax</span><br><span class="line">mov di,160*12</span><br><span class="line">mov bx,offset s-offset se</span><br><span class="line">mov cx,80</span><br><span class="line">s:mov byte ptr es:[di],&#39;!&#39;</span><br><span class="line">add di,2</span><br><span class="line">int 7ch</span><br><span class="line">se:nop</span><br><span class="line">···</span><br><span class="line">1234567891011</span><br></pre></td></tr></table></figure>

<p>7ch实现部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lp:push bp</span><br><span class="line">mov bp,sp</span><br><span class="line">dec cx</span><br><span class="line">jcxz lpret</span><br><span class="line">add [bp+2],bx</span><br><span class="line">lpret:pop bp</span><br><span class="line">iret</span><br><span class="line">1234567</span><br></pre></td></tr></table></figure>

<p>因为bx里面是需要专一的偏移地址，而使用bp的时候默认段寄存器是ss，所以add [bp+2],bx就可以实现将栈中的sp的值修改回s处，自行推导一下就ok。</p>
<h5 id="BIOS和DOS提供的中断例程"><a href="#BIOS和DOS提供的中断例程" class="headerlink" title="BIOS和DOS提供的中断例程"></a><strong>BIOS和DOS提供的中断例程</strong></h5><p>系统ROM中存放着一套程序，称为BIOS，除此之外还有DOS都提供了一套可以供我们调用的中断例程，不同历程有不同的中断类型码，并且还能根据传入的参数不同而实现不同的功能，也就是说同一个类型码的中断例程可以实现很多不同功能，如int 10h是BIOS提供的包含了多个和屏幕输出相关子程序的中断例程。传参数如下面例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">mov ah,2 ;置光标</span><br><span class="line">mov bh,0 ;第0页</span><br><span class="line">mov dh,5 ;dh中放行号</span><br><span class="line">mov dl,12 ;dl中放列号</span><br><span class="line">int 10h</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>

<p>BIOS和DOS安装历程的过程是，开机后CPU一加电，自动初始化CS为0FFFFH，IP为0，而在这个地方有一个跳转指令，挑战到BIOS和系统检测初始化程序。在BIOS系统检测初始化程序中会设置中断向量表中的值。</p>
<h3 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h3><h5 id="端口的概念"><a href="#端口的概念" class="headerlink" title="端口的概念"></a><strong>端口的概念</strong></h5><p>各种存储器都要和CPU的地址线，数据线，控制线相连，在CPU看来，总线就是一个由若干个存储单元构成的逻辑存储器，称之为内存地址空间。除了各种存储器，通过总线和CPU相连的还有下面三种芯片：</p>
<ul>
<li>各种接口卡（如网卡显卡）上的接口芯片，他们控制接口卡工作</li>
<li>主板上的接口芯片，CPU通过它们访问外部设备</li>
<li>其他芯片，用来存储相关系统信息，或进行相应的输入输出</li>
</ul>
<p>上面的芯片中都有一种由CPU读写的寄存器，它们都和CPU的总线相连（通过各自的芯片），CPU对他们进行读写时候都通过控制线向他们所在的芯片发出端口读写指令。</p>
<p>所以，对于CPU来说，将这些寄存器都当做端口，对他们进行统一编址，建立了一个端口地址空间，每一个端口拥有一个地址，所以CPU可以直接读取下面三个地方的数据：</p>
<ul>
<li>CPU内部的寄存器</li>
<li>内存单元</li>
<li>端口</li>
</ul>
<h5 id="端口的写"><a href="#端口的写" class="headerlink" title="端口的写"></a><strong>端口的写</strong></h5><p>因为端口所在的芯片和CPU通过总线相连，所以端口地址和内存地址一样通过地址总线传送，并且在PC系统中，CPU最多可以定位64KB个不同的端口，所以端口地址范围是0~65535。</p>
<p>对端口的读写不能使用mov,push,pop等内存读写指令，端口的读写指令只有两个：in和out分别用于从端口读取数据和往端口写入数据。</p>
<p>访问端口的步骤：</p>
<ol>
<li>CPU通过地址总线降低至信息60h发出</li>
<li>CPU通过控制线发出端口读命令，选中端口所在芯片，并通知它要从中读取数据</li>
<li>端口所在芯片将目标端口中的数据通过数据线送入CPU</li>
</ol>
<p>注：在in和out指令中，只能通过ax或al来存放从端口中读入的数据或要发送到端口中的数据，且访问8位端口时，用al，访问16位端口用ax。</p>
<p>对0~255以内的端口进行读写时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">in al,20h</span><br><span class="line">out 20h,al</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>对256~65535的端口进行读写时，需要将端口号写在dx中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov dx，3f8h</span><br><span class="line">in al,dx</span><br><span class="line">out dx,al</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<h5 id="CMOS-RAM芯片"><a href="#CMOS-RAM芯片" class="headerlink" title="CMOS RAM芯片"></a><strong>CMOS RAM芯片</strong></h5><p>PC中有一个叫做CMOS RAM的芯片，称为CMOS，有如下特征：</p>
<ul>
<li>包含一个实时钟和一个有128个存储单元的RAM存储器（早期的计算机64个字节）</li>
<li>靠电池供电，关机后内部的实时钟仍可继续工作，RAM中的信息不丢失</li>
<li>128个字节的RAM中，内部实时钟占用0~0dh单元保存时间信息，其余大部分单元用于保存系统配置信息，供系统启动时BIOS程序读取，BIOS也提供了相关的程序可以让我们在开机时配置CMOS中的系统信息。</li>
<li>芯片内部有两个端口70h和71h，CPU通过这两个端口读写CMOS</li>
<li>70h为地址端口，存放要访问CMOS单元的地址，71h为数据端口，存放从选定的单元中读取的数据，或写入的数据。</li>
</ul>
<p>所以可以看出，想要从CMOS中读取数据，应分两步，先将单元号送入70h，然后再从71h读出对应号的数据。</p>
<h5 id="shl和shr指令"><a href="#shl和shr指令" class="headerlink" title="shl和shr指令"></a><strong>shl和shr指令</strong></h5><p>shl和shr是逻辑移位指令，shl是逻辑左移，功能为：</p>
<ol>
<li>将一个寄存器或内存单元中的数向左移位</li>
<li>将最后移出的一位写入CF</li>
<li>最低位补0</li>
</ol>
<p>如：mov al,01001000b shl al,1执行结束后(al)=10010000b，CF=0。</p>
<p>注：如果移动位数大于1，那么必须将移动位数写在cl中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov al,01010001b</span><br><span class="line">mov cl,3</span><br><span class="line">shl al,cl</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>执行后(al)=10001000b,最后移出的一位是0，所以CF=0。可以看出左移操作相当于x=x*2。</p>
<p>右移shr同理，最高位用0补充，移出的写入CF，若移动位数大于1，也要写在cl中，相当于x=x/2</p>
<p>在CMOS中存放着当前时间的年月日时分秒，分别存在下面的单元内：</p>
<table>
<thead>
<tr>
<th>秒</th>
<th>分</th>
<th>时</th>
<th>日</th>
<th>月</th>
<th>年</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>2</td>
<td>4</td>
<td>7</td>
<td>8</td>
<td>9</td>
</tr>
</tbody></table>
<p>每个信息使用一个字节存放，以BCD码的形式，BCD码是对0-9这几个数字使用二进制表示，如：</p>
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody><tr>
<td>0000</td>
<td>0001</td>
<td>0010</td>
<td>0011</td>
<td>0100</td>
<td>0101</td>
<td>0110</td>
<td>0111</td>
<td>1000</td>
<td>1001</td>
</tr>
</tbody></table>
<p>如果要表示一个两位数如13，就是一个字节高四位是十位1的BCD码，低四位是个位3的BCD码，表示为00010011b。下面程序获取当前月份：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">mov al,8</span><br><span class="line">out 70h,al   ;要从8号单元读取数据，所以先将8号单元送入70h端口</span><br><span class="line">in al,71h    ;从71h端口拿数据</span><br><span class="line"></span><br><span class="line">mov ah,al    ;复制一下</span><br><span class="line">mov cl,4     </span><br><span class="line">shr ah,cl    ;ah右移四位，ah里面的就是月份的十位</span><br><span class="line">and al,00001111b  ;al里面剩下的就是月份的个位</span><br><span class="line">123456789</span><br></pre></td></tr></table></figure>

<h3 id="外中断"><a href="#外中断" class="headerlink" title="外中断"></a>外中断</h3><h5 id="接口芯片和端口"><a href="#接口芯片和端口" class="headerlink" title="接口芯片和端口"></a><strong>接口芯片和端口</strong></h5><p>CPU除了需要拥有运算的能力，还要拥有I/O（输入输出）能力，我们键入一个字母，要能处理，所以我们需要面对的是：外部设备随时的输入和CPU何处得到外部设备的输入。</p>
<p>外部设备拥有自己的芯片连接到主板上，这些芯片内部由若干寄存器，而CPU将这些寄存器当做端口访问，外设的输入或CPU向外设输出都是送给对应的端口然后再由芯片处理送给目标（CPU或外设）。</p>
<h5 id="外中断-1"><a href="#外中断-1" class="headerlink" title="外中断"></a><strong>外中断</strong></h5><p>CPU提供外中断来处理这些如随时可能出现的来自外设的输入，在PC系统中，外中断源有以下两类：</p>
<p>可屏蔽中断：CPU可以不响应的外部中断，CPU是否响应看标志寄存器IF的设置，如果IF=1，CPU执行完当前指令后响应中断，如果IF=0，则不响应。可屏蔽中断的执行步骤和内部中断类似：</p>
<ol>
<li>获取中断类型码n（从外部通过总线输入）</li>
<li>标志寄存器入栈，IF=0，TF=0</li>
<li>CS，IP入栈</li>
<li><code>(IP)=(n*4)，(CS)=(n*4+2)</code></li>
</ol>
<p>可见，将IF置零的原因是以免在处理中断程序的时候再发生中断。当然我们也可以选择处理，下面两个指令可以改变IF的值：sti，设置IF=1，cli，设置IF=0。</p>
<p>不可屏蔽中断：CPU必须响应的外部中断，CPU检测到不可屏蔽中断后执行完当前指令立即响应中断。8086CPU中不可屏蔽中断的中断类型码固定位2，所以中断过程中不需要获取中断类型码，步骤：</p>
<ol>
<li>标志寄存器入栈，IF=0，TF=0</li>
<li>CS，IP入栈</li>
<li>(IP)=(8),(CS)=(0AH)</li>
</ol>
<p>几乎所有由外设引发的外中断都是可屏蔽中断，如键盘输入，不可屏蔽中断通常是在系统中又必须处理的紧急情况发生时通知CPU的中断信息。</p>
<h5 id="PC键盘处理过程"><a href="#PC键盘处理过程" class="headerlink" title="PC键盘处理过程"></a><strong>PC键盘处理过程</strong></h5><p>键盘上每个按键都相当于一个开关，按下就是开关接通，抬起就是开关断开。键盘上有一个芯片对键盘中每一个键盘的状态进行扫描，开关按下生成一个扫描码——通码，记录按下的按键位置，开关抬起也会产生一个扫描——断码，码记录松开的位置，都是送入60h端口。通码的第7位为0，断码第7位为1，也就是说断码=通码+80h。P247表。</p>
<p>当键盘输入送达60h时，相关新品就会向CPU发送中断类型码为9的可屏蔽中断信息。CPU检测到该中断信息之后，如果IF=1，响应中断，引发中断过程并执行int9的中断例程。BIOS中int9的中断程序用来进行基本的键盘输入处理，步骤如下：</p>
<ol>
<li>读出60h的扫描码</li>
<li>如果是字符的扫描码，将对应的字符的ASCII吗存入内存中的BIOS键盘缓冲区，如果是控制键（Ctrl）和切换键（CapsLock）扫描码，则将其转换为状态字（二进制位记录控制键和切换键状态的字节）写入内存中的存储状态字节的单元。</li>
<li>对键盘系统进行相关控制，如向新平发出应答</li>
</ol>
<p>BIOS中键盘缓冲区能存储15个键盘输入，每个键盘输入两字节，高位存放扫描码，低位存放字符。此外，0040:17单元存放键盘状态字节，记录了控制键和切换键的状态，记录信息如下：</p>
<table>
<thead>
<tr>
<th>位</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>右shift，1表示按下</td>
</tr>
<tr>
<td>1</td>
<td>左shift，1按下</td>
</tr>
<tr>
<td>2</td>
<td>Ctrl，1按下</td>
</tr>
<tr>
<td>3</td>
<td>Alt，1按下</td>
</tr>
<tr>
<td>4</td>
<td>ScrollLock状态，1表示指示灯亮</td>
</tr>
<tr>
<td>5</td>
<td>NumLock状态，1表示小键盘输入的是数字</td>
</tr>
<tr>
<td>6</td>
<td>CapsLock状态，1表示大写字母</td>
</tr>
<tr>
<td>7</td>
<td>Insert状态，1表示处于删除状态</td>
</tr>
</tbody></table>
<p>可以看书P276的一个改写int 9的中断例程。</p>
<h3 id="直接定址表"><a href="#直接定址表" class="headerlink" title="直接定址表"></a>直接定址表</h3><h5 id="描述单元长度的标号"><a href="#描述单元长度的标号" class="headerlink" title="描述单元长度的标号"></a><strong>描述单元长度的标号</strong></h5><p>我们可以使用下面的标号来表示数据的开始：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">code segment</span><br><span class="line">a:db 1,2,3,4,5,6,7,8</span><br><span class="line">b:dw 0</span><br><span class="line">···</span><br><span class="line">code ends</span><br><span class="line">···</span><br><span class="line">1234567</span><br></pre></td></tr></table></figure>

<p>a，b都是代表对应数据的起始地址，但并不能判断数据的长度或类型。下面一段程序将a中的8个数累加存入b中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line">a db 1,2,3,4,5,6,7,8</span><br><span class="line">b dw 0</span><br><span class="line">start mov si,0</span><br><span class="line">mov cx,8</span><br><span class="line">s:mov al,a[si]</span><br><span class="line">mov ah,0</span><br><span class="line">add b,ax</span><br><span class="line">inc si</span><br><span class="line">loop s</span><br><span class="line">mov ax,4c00h</span><br><span class="line">int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">123456789101112131415</span><br></pre></td></tr></table></figure>

<p>code段中a和b后并没有”:”号，这种写法同时描述内存地址和单元长度的标号。a描述了地址code:0和从这个地址开始后的内存单元都是字节单元，而b描述了地址code:8和从这个地址开始以后的内存单元都是字单元。所以b相当于CS:[8]，a[si]相当于CS:0[si]，使用这种标号，我们可以间接地访问内存数据。</p>
<h5 id="其它段中使用数据标号"><a href="#其它段中使用数据标号" class="headerlink" title="其它段中使用数据标号"></a><strong>其它段中使用数据标号</strong></h5><p>刚说的第一种标号即加”:”号的标号，只能使用在代码段中，不能在其他段中使用。如果想要在其它段中（如data段）使用标号可以使用第二种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code,ds:data</span><br><span class="line">data segment</span><br><span class="line">a db 1,2,3,4,5,6,7,8</span><br><span class="line">b dw 0</span><br><span class="line">data ends</span><br><span class="line">···</span><br><span class="line">start mov ax,data</span><br><span class="line">mov ds,ax</span><br><span class="line">mov si,0</span><br><span class="line">mov al,a[si]</span><br><span class="line">···</span><br><span class="line">1234567891011</span><br></pre></td></tr></table></figure>

<p>如果想在代码段中直接使用数据标号访问数据，需要使用assume伪指令将标号所在段和一个寄存器联系起来，是让寄存器明白，我们要访问的数据在ds指向的段中，但编译器并不会真的将段地址存入ds中，我们做了如下假设之后，编译器在编译的时候就会默认ds中已经存放了data的地址，如下面的编译例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov al,a[si]</span><br><span class="line">编译为：mov al,[si+0]</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>可以看出编译器默认了a[si]在ds所在的段中。所以我们需要手工指定ds指向data：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov ax,data</span><br><span class="line">mov ds,ax</span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<p>也可以这么使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data segment</span><br><span class="line">a db 1,2,3,4,5,6,7,8</span><br><span class="line">b dw 0</span><br><span class="line">c a,b</span><br><span class="line">data ends</span><br><span class="line">12345</span><br></pre></td></tr></table></figure>

<p>c处存放的是a和b的偏移地址，相当于c dw offset a,offset b。同理c dd a,b相当于c dw offset a,seg a,offset b,seg b即存的是a和b的段地址和偏移地址。</p>
<h5 id="直接定址表-1"><a href="#直接定址表-1" class="headerlink" title="直接定址表"></a><strong>直接定址表</strong></h5><p>使用查表的方法编写相关程序，如输出一个字节型数据的16进制形式（子程序）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">showbyte jmp short show</span><br><span class="line">table db &#39;0123456789ABCDEF&#39;</span><br><span class="line">show:push bx</span><br><span class="line">push es</span><br><span class="line">mov ah,al</span><br><span class="line">she ah,1</span><br><span class="line">she ah,1</span><br><span class="line">she ah,1</span><br><span class="line">she ah,1 ;右移四位，位移子程序限制使用的寄存器数，只能这么移</span><br><span class="line">and al,00001111b</span><br><span class="line">mov bl,al</span><br><span class="line">mov bh,0</span><br><span class="line">mov ah,table[bx]  ;高四位作为相对于table的偏移，取得对应字符</span><br><span class="line">mov bx,0b800h</span><br><span class="line">mov es,bx</span><br><span class="line">mov es:[160*12+40*2],ah</span><br><span class="line">mov bl,al</span><br><span class="line">mov bh,0</span><br><span class="line">mov al,table[bx]</span><br><span class="line">mov es:[160*12+40*2+2],al</span><br><span class="line">pop es</span><br><span class="line">pop bx</span><br><span class="line">ret</span><br><span class="line">1234567891011121314151617181920212223</span><br></pre></td></tr></table></figure>

<p>可见我们直接使用需要的数值和地址的映射关系来寻找需要的数据。</p>
<h5 id="程序入口地址的直接定址表"><a href="#程序入口地址的直接定址表" class="headerlink" title="程序入口地址的直接定址表"></a><strong>程序入口地址的直接定址表</strong></h5><p>可以看书P296的例程，主要思想是，编写多个子程序实现不同功能，每个子程序有自己的标号，如sub1，sub2···等。将它们存在一个表中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">table dw sub1,sub2,sub3,sub4</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>然后按照之前的方法使用如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setscreen:jmp short set</span><br><span class="line">table dw sub1,sub2,sub3,sub4</span><br><span class="line">set:push bx</span><br><span class="line">cmp ah,3</span><br><span class="line">ja sret</span><br><span class="line">mov bl,ah</span><br><span class="line">mov bh,0</span><br><span class="line">add bx,bx</span><br><span class="line">call word ptr table[bx]</span><br><span class="line">sret:pop bx</span><br><span class="line">ret</span><br><span class="line">1234567891011</span><br></pre></td></tr></table></figure>

<h3 id="使用BIOS进行键盘输入和磁盘读写"><a href="#使用BIOS进行键盘输入和磁盘读写" class="headerlink" title="使用BIOS进行键盘输入和磁盘读写"></a>使用BIOS进行键盘输入和磁盘读写</h3><h5 id="int-9中断例程对键盘输入的处理"><a href="#int-9中断例程对键盘输入的处理" class="headerlink" title="int 9中断例程对键盘输入的处理"></a><strong>int 9中断例程对键盘输入的处理</strong></h5><p>键盘处理依次按下A,B,C,D,E,shift_A,A的过程：</p>
<p>我们知道，键盘有16字的缓冲区，可以存放15个按键的扫描码和对应的ASCII码值，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">|	|	|	|	|	|	|	|	|	|	|	|	|	|	|	|	|</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>我们按下A时，引发键盘中断，CPU执行int 9中断例程，从60h端口读出A键通码，然后检测状态字，看是否有控制键或切换键按下，发现没有，将A的扫描码1eh和对应的ASCII码’a’61h写在缓冲区：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">|1e61|	|	|	|	|	|	|	|	|	|	|	|	|	|	|	|	|</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>然后BCDE同理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">|1e61|3062|2e63|2064|1265|	|	|	|	|	|	|	|	|	|	|	|	|	|	|	|	|</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>在按下shift之后引发键盘中断，int 9程序接受了shift的通码之后设置0040:17处状态字第一位为1，表示左shift按下，接下来按A间，引发中断，int 9中断例程从60h端口督导通码之后检测状态字，发现左shift被按下，于是将A的键盘扫描码1eh和’A’的ASCII41h写入缓冲区：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">|1e61|3062|2e63|2064|1265|1e41|	|	|	|	|	|	|	|	|	|	|	|	|	|	|	|</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>松开shift，0040:17第一位变回0,之后又按下A和之前一样。</p>
<h5 id="int-16h读取键盘缓冲区"><a href="#int-16h读取键盘缓冲区" class="headerlink" title="int 16h读取键盘缓冲区"></a><strong>int 16h读取键盘缓冲区</strong></h5><p>int 16h可以供程序员调用，编号为0的功能是从键盘缓冲区读一个键盘输入，(ah)=扫描码，(al)=ascii码。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov ah,0</span><br><span class="line">int 16h</span><br><span class="line">|3062|2e63|2064|1265|1e41|	|	|	|	|	|	|	|	|	|	|	|	|	|	|	|</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>执行后，缓冲区第一个没了，然后ah中是1eh，al中是61h。如果缓冲区为空的时候执行，那么会循环等待知道缓冲区有数据，所以int 16h的0号功能的步骤是：</p>
<ol>
<li>检测键盘缓冲区是否有数据</li>
<li>没有则继续1</li>
<li>读取第一个单元的键盘输入</li>
<li>扫描码送ah，ascii码送al</li>
</ol>
<h5 id="int-13h读写磁盘"><a href="#int-13h读写磁盘" class="headerlink" title="int 13h读写磁盘"></a><strong>int 13h读写磁盘</strong></h5><p>3.5寸软盘分为上下两面，每面80个磁道，每个磁道18个扇区，每个扇区512字节，共约1.44MB。磁盘的实际访问时磁盘控制器进行的，我们通过控制磁盘控制器来控制磁盘，只能以扇区为单位读写磁盘，每次需要给出面号，磁道号，和扇区号，面号和磁道号从0开始，扇区号从1开始。BIOS提供int 13h来实现访问磁盘，读取0面0道1扇区的内容到0:200的程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mov ax,0</span><br><span class="line">mov es,ax</span><br><span class="line">mov bx,200h</span><br><span class="line"></span><br><span class="line">mov al,1   ;读取的扇区数</span><br><span class="line">mov ch,0   ;磁道号</span><br><span class="line">mov cl,1   ;扇区号</span><br><span class="line">mov dl,0   ;驱动器号，0开始，0软驱A，1软驱B，磁盘从80h开始，80h硬盘C，81h硬盘D</span><br><span class="line">mov dh,0   ;磁头号（软盘面号）</span><br><span class="line">mov ah,2   ;13h的功能号，2表示读扇区</span><br><span class="line">int 13h</span><br><span class="line">1234567891011</span><br></pre></td></tr></table></figure>

<p>es:bx指向接收数据的内存区。操作成功(ah)=0,(al)=读入的扇区数，操作失败(ah)=错误代码。将0:200的数据写入0面0道1扇区：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mov ax,0</span><br><span class="line">miv es,ax</span><br><span class="line">mov bx,200h</span><br><span class="line"></span><br><span class="line">mov al,1   ;读取的扇区数</span><br><span class="line">mov ch,0   ;磁道号</span><br><span class="line">mov cl,1   ;扇区号</span><br><span class="line">mov dl,0   ;驱动器号</span><br><span class="line">mov dh,0   ;磁头号（软盘面号）</span><br><span class="line">mov ah,3   ;13h的功能号，3表示写扇区</span><br><span class="line">int 13h</span><br><span class="line">1234567891011</span><br></pre></td></tr></table></figure>

<p>es:bx指向写入磁盘的数据，操作成功(ah)=0,(al)=写入的扇区数，操作失败(ah)=错误代码</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/29/C++%E7%BC%96%E8%AF%91%E7%A8%8B%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/29/C++%E7%BC%96%E8%AF%91%E7%A8%8B%E5%BA%8F/" class="post-title-link" itemprop="url">C++编译产生文件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-12-29 20:57:56 / 修改时间：21:00:13" itemprop="dateCreated datePublished" datetime="2020-12-29T20:57:56+08:00">2020-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>C++编译 （.obj, .lib, .dll, .exe的关系）</p>
<h2 id="一、总体介绍："><a href="#一、总体介绍：" class="headerlink" title="一、总体介绍："></a>一、总体介绍：</h2><p>c++程序在编译后,在目标路径下会生成多个文件：</p>
<p>Debug文件夹(<em>.exe,</em>.ilk,<em>.obj,</em>.pch,<em>.pdb,</em>.idb,<em>,pdb),</em>.cpp,<em>.dsp,</em>.ncb,*.plg</p>
<p>*.exe:是生成的可执行文件</p>
<p>*.ilk:当选定渐增型编译连接时，连接器自动生成ILK文件，记录连接信息</p>
<p>*.obj:是目标文件,源程序编译后的产物</p>
<p>*.pch:全称是PreCompiled Header，就是预先编译好的头文件</p>
<p>*.idb:文件保存的信息,使编译器在重新编译的时候只重编译最新改动过的函数和只对最新类定义改动过的源文件进行重编译，以提高编译速度</p>
<p>*.pdb:全称是Program DataBase，即程序数据库文件，用来记录调试信息</p>
<p>*.dsp:(全称是Developer Studio Project)也是一个配置文件</p>
<p>*.ncb:(全称No Compile Browser)的缩写，其中存放了供ClassView、WizardBar和Component Gallery使用的信息，由VC开发环境自动生成</p>
<p>*.plg:实际上是一个超文本文件，可以用Internet Explorer打开，记录了Build的过程</p>
<p>*.cpp:就是C++源代码文件.</p>
<h2 id="二、具体介绍："><a href="#二、具体介绍：" class="headerlink" title="二、具体介绍："></a>二、具体介绍：</h2><p>lib是和dll对应的。</p>
<p>lib是静态的库文件，dll是动态的库文件。</p>
<p>所谓静态就是link的时候把里面需要的东西抽取出来安排到你的exe文件中，以后运行   你的exe的时候不再需要lib。</p>
<p>所谓动态就是exe运行的时候依赖于dll里面提供的功能，没有这个dll，你的exe无法运行。</p>
<p>lib,   dll,   exe都算是最终的目标文件，是最终产物。而c/c++属于源代码。源代码和最终目标文件中过渡的就是中间代码obj，实际上之所以需要中间代码，是你不可能一次得到目标文件。</p>
<p>比如说一个exe需要很多的cpp文件生成。而编译器一次只能编译一个cpp文件。</p>
<p>这样编译器编译好一个cpp以后会将其编译成obj，当所有必须要的cpp都编译成obj以后，再统一link成所需要exe，应该说缺少任意一个obj都会导致exe的链接失败。</p>
<p>obj里存的是编译后的代码跟数据，并且有名称，所以在连接时会出现未解决的外部符号一说。当连成exe后便不存在名称的概念了，只有地址。lib就是一堆obj的组合。</p>
<p>2.理论上可以，但实际中通常用lib。</p>
<p>3.编译器会默认链接一些常用的库，其它的需要你自己指定。</p>
<h2 id="三、附上lib和DLL的区别"><a href="#三、附上lib和DLL的区别" class="headerlink" title="三、附上lib和DLL的区别"></a>三、附上lib和DLL的区别</h2><p>(1)lib是编译时需要的，dll是运行时需要的。 </p>
<p>如果要完成源代码的编译，有lib就够了。 </p>
<p>如果也使动态连接的程序运行起来，有dll就够了。 </p>
<p>在开发和调试阶段，当然最好都有。 </p>
<p>(2)一般的动态库程序有lib文件和dll文件。</p>
<p>lib文件是必须在编译期就连接到应用程序中的，而dll文件是运行期才会被调用的。如果有dll文件，那么对应的lib文件一般是一些索引信息，具体的实现在dll文件中。</p>
<p>如果只有lib文件，那么这个lib文件是静态编译出来的，索引和实现都在其中。静态编译的lib文件有好处：给用户安装时就不需要再挂动态库了。</p>
<p>但也有缺点，就是导致应用程序比较大，而且失去了动态库的灵活性，在版本升级时，同时要发布新的应用程序才行。 </p>
<p>(3)在动态库的情况下，有两个文件，一个是引入库（.LIB）文件，一个是DLL文件。</p>
<p>引入库文件包含被DLL导出的函数的名称和位置，DLL包含实际的函数和数据，应用程序使用LIB文件链接到所需要使用的DLL文件，库中的函数和数据并不复制到可执行文件中，因此在应用程序的可执行文件中，存放的不是被调用的函数代码，而是DLL中所要调用的函数的内存地址。</p>
<p>这样当一个或多个应用程序运行是再把程序代码和被调用的函数代码链接起来，从而节省了内存资源。</p>
<p>从上面的说明可以看出，DLL和.LIB文件必须随应用程序一起发行，否则应用程序将会产生错误。</p>
<h2 id="四、c-obj文件bai与exe文件的区别："><a href="#四、c-obj文件bai与exe文件的区别：" class="headerlink" title="四、c++ obj文件bai与exe文件的区别："></a>四、c++ obj文件bai与exe文件的区别：</h2><h3 id="一、作用的区别"><a href="#一、作用的区别" class="headerlink" title="一、作用的区别"></a>一、作用的区别</h3><p>obj文件当前源代zhi码编译成二dao进制目标文zhuan件（.obj文件）</p>
<p>exe文件将生成的shu.obj文件与库文件.lib等文件链接，生成可执行文件（.exe文件）。</p>
<h3 id="二、给出文件地址的区别"><a href="#二、给出文件地址的区别" class="headerlink" title="二、给出文件地址的区别"></a>二、给出文件地址的区别</h3><p>obj文件给出了程序的相对地址。</p>
<p>exe文件给出了程序的绝对地址。</p>
<h3 id="三、编译生成文件的区别"><a href="#三、编译生成文件的区别" class="headerlink" title="三、编译生成文件的区别"></a>三、编译生成文件的区别</h3><p>obj文件由.cpp的源程序经过编译生成机器可理解执行的二进制文件。</p>
<p>exe文件经过链接器同cpp的标准库以及其他用户自己的库进行连接，多个obj文件生成一个exe。</p>
<h3 id="四、类型的区别"><a href="#四、类型的区别" class="headerlink" title="四、类型的区别"></a>四、类型的区别</h3><p>obj文件是3D模型文件格式，属于编译类，结构不完整，可以看成是exe的一部分。</p>
<p>exe文件是可执行文件，属于链接（link）类，程序并非只作简单的拷贝与组合。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/29/%E6%B1%87%E7%BC%96%E4%B8%8A%E6%9C%BA%E6%B6%89%E5%8F%8A%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/29/%E6%B1%87%E7%BC%96%E4%B8%8A%E6%9C%BA%E6%B6%89%E5%8F%8A%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">汇编上机涉及文件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-29 20:39:25" itemprop="dateCreated datePublished" datetime="2020-12-29T20:39:25+08:00">2020-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-31 16:15:29" itemprop="dateModified" datetime="2020-12-31T16:15:29+08:00">2020-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B1%87%E7%BC%96/" itemprop="url" rel="index"><span itemprop="name">汇编</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ASM是汇编语言源程序的扩展名，汇编语言(Assembly Language)是面向机器的程序设计bai语言。汇编语言是一种功能很强的程序设计语言，是利用计算机所有硬件特性并能直接控制硬件的语言。打开asm文件有两种方法即笔记本和MasmEdit软件。</p>
<p>在汇编语言中，用助记符(Memoni)代替操作码，用地址符号(Symbol)或标号(Label)代替地址码。这样用符号代替机器语言的二进制码，就把机器语言变成了汇编语言。因此汇编语言亦称为符号语言。</p>
<p>使用汇编语言编写的程序，机器不能直接识别，要由一种程序将汇编语言翻译成机器语言，这种起翻译作用的程序叫汇编程序，汇编程序是系统软件中语言处理系统软件。汇编程序把汇编语言翻译成机器语言的过程称为汇编。</p>
<p>汇编语言比机器语言易于读写、调试和修改，同时具有机器语言全部优点。但在编写复杂程序时，相对高级语言代码量较大，而且汇编语言依赖于具体的处理器体系结构，不能通用，因此不能直接在不同处理器体系结构之间移植。</p>
<p>汇编语言的特点</p>
<p>1、面向机器的低级语言，通常是为特定的计算机或系列计算机专门设计的。</p>
<p>2、保持了机器语言的优点，具有直接和简捷的特点。</p>
<p>3、可有效地访问、控制计算机的各种硬件设备，如磁盘、存储器、CPU、I/O端口等。</p>
<p>4、目标代码简短，占用内存少，执行速度快，是高效的程序设计语言。</p>
<p>5、经常与高级语言配合使用，应用十分广泛。</p>
<h2 id="1、-asm文件（编辑产生文件）"><a href="#1、-asm文件（编辑产生文件）" class="headerlink" title="1、.asm文件（编辑产生文件）"></a>1、.asm文件（编辑产生文件）</h2><p><strong>汇编语言源程序文件。edit.com编译产生</strong>。</p>
<p>.asm文件是bai以asm作为扩展名的du文件zhi，是汇编语言的源程序文件。dao它是文本格式的文件，可以用zhuan任何文shu本编辑器（如：windows下的notepad、notepad＋、editplus、ultraedit，dos下的edit.com、qe.exe等）进行创建或编辑。<br>这种类型的文件必须满足微软或borland或其他开源组织对汇编语言源代码的语法规则的要求。如果你写的.asm文件不满足语法规则、或者存在算法或者业务逻辑上的错误，前者将无法通过编译程序的编译，后者即使生成了可执行程序也不能得到你需要的结果。<br>与上节对应，.asm文件的编译器有微软的masm（masm32）、borland公司的tasm、开源组织的nasm等，通过这些编译器编译后将生成扩展名为obj的目标文件。再通过对应的链接程序（如link、tlink等）将obj文件转化为可执行的exe文件。</p>
<h2 id="2、汇编产生文件"><a href="#2、汇编产生文件" class="headerlink" title="2、汇编产生文件"></a>2、汇编产生文件</h2><p><strong>masm.exe汇编产生：.obj .lst .crf文件</strong></p>
<p><strong>Masm.exe 汇编系统程序，用于将汇编语言源程序(.asm)汇编成目标程序(.obj)。</strong></p>
<h3 id="2-1、-obj文件"><a href="#2-1、-obj文件" class="headerlink" title="2.1、.obj文件"></a>2.1、.obj文件</h3><p><strong>.obj文件为目标文件，即汇编产生的目标文件。</strong></p>
<p><strong>编译：当前源代码编译成二进制目标文件bai（.obj文件）</strong></p>
<p><strong>链接（link）：将生成的.obj文件与库文件.lib等文件链接，生成可执行文件（.exe文件）。</strong></p>
<p><strong>可以说.obj文件是.exe文件的前身；</strong></p>
<p>1、obj里存的是编译后的代码跟数据，并且有名称，所以在连接时会出现未解决的外部符号一说。当连成exe后便不存在名称的概念了，只有地址。lib就是一堆obj的组合。   </p>
<p>编译器会默认链接一些常用的库，其它的需要你自己指定。</p>
<p>2、目标文件，一般是程序编译后的【二进制文件】，再通过链接器和资源文件链接就成可执行文件了。OBJ只给出了程序的【相对地址】，而可执行文件是【绝对地址】。CPP对应的二进制代码格式obj，是未经重定位的！</p>
<p>3、编译C 程序会产生obj 文件和exe 文件，我们都知道exe 文件是可执行文件，但obj 文件是做什么用的呢？</p>
<p>查了下资料发现obj 文件和exe 文件都是二进制数据文件，其中obj 文件是COFF 格式，exe 文件时PE 格式。</p>
<p>那为什么不直接让 obj 文件作为可执行文件呢？</p>
<p>原来obj 文件的格式是跨平台 的，通过link 可以将obj 链接为所使用系统能够识别的格式，比如windows 系统中的exe 文件。</p>
<p>一个现代编译器的主要工作流程如下：<br>源程序（source code）→ 预处理器（preprocessor）→ 编译器（compiler）→ 汇编程序（assembler）→ 目标程序（object code）→ 连接器（链接器，Linker）→ 可执行程序（executables）</p>
<h3 id="2-2、-lst文件"><a href="#2-2、-lst文件" class="headerlink" title="2.2、.lst文件"></a>2.2、.lst文件</h3><p><strong>.lst文件为列表文件，</strong>左边的数字是汇编程序的二进制输出，与源代码行有关。即里面是左边为机器指令，右边为汇编指令。</p>
<h3 id="2-3、-crf文件"><a href="#2-3、-crf文件" class="headerlink" title="2.3、.crf文件"></a>2.3、.crf文件</h3><p><strong>.crf文件为交叉索引文件，</strong>它负责记录符号名定义的行号以及引用的行号。</p>
<h2 id="3、连接产生文件"><a href="#3、连接产生文件" class="headerlink" title="3、连接产生文件"></a>3、连接产生文件</h2><p><strong>link.exe连接产生：.exe .map文件</strong></p>
<p>Link.exe 连接程序，用于将汇编后的目标文件(.obj)连接生成可执行文件(.exe)。以下是它的格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link obj[,exe[,map[,lib]]]</span><br></pre></td></tr></table></figure>

<h3 id="3-1、-exe文件"><a href="#3-1、-exe文件" class="headerlink" title="3.1、.exe文件"></a>3.1、.exe文件</h3><p>.exe文件是可执行文件。</p>
<h3 id="3-2、-map文件"><a href="#3-2、-map文件" class="headerlink" title="3.2、.map文件"></a>3.2、.map文件</h3><p>.map文件是列表映像文件，负责记录段的开始、结束地址以及段的长度。</p>
<h2 id="4、交叉索引产生文件"><a href="#4、交叉索引产生文件" class="headerlink" title="4、交叉索引产生文件"></a>4、交叉索引产生文件</h2><p><strong>cref.exe交叉索引产生文件：ref</strong></p>
<h3 id="4-1、-ref文件"><a href="#4-1、-ref文件" class="headerlink" title="4.1、.ref文件"></a>4.1、.ref文件</h3><p><strong>.ref文件为交叉列表文件，用于记录源程序符号名定义和引用位置行数。</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/27/STLvector%E7%9A%84%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/27/STLvector%E7%9A%84%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">STLvector的应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-27 15:35:55" itemprop="dateCreated datePublished" datetime="2020-12-27T15:35:55+08:00">2020-12-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/27/STLtraits%20%E7%BC%96%E7%A8%8B%E6%8A%80%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/27/STLtraits%20%E7%BC%96%E7%A8%8B%E6%8A%80%E6%B3%95/" class="post-title-link" itemprop="url">STLtraits编程技法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-27 15:35:27" itemprop="dateCreated datePublished" datetime="2020-12-27T15:35:27+08:00">2020-12-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-29 21:37:30" itemprop="dateModified" datetime="2020-12-29T21:37:30+08:00">2020-12-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>迭代器是一种抽象的设计概念，定义为：提供一种方法，使之能够依序巡访某个容器所含的各个元素，而又无需暴露该容器的内部表达式。迭代器是一种类似指针的对象，具有遍历复杂数据结构的能力，其下层运行机制取决于其所遍历的数据结构，因此，每一种容器型别都必须提供自己的迭代器。事实上每种容器都将其迭代器以嵌套方式定义于内部。</p>
<p>迭代器相应型别</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&lt;stl_iterator_base.h&gt;, stl source code v3.3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">iterator</span> &#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> _Category  iterator_category;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> _Tp        value_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> _Distance  difference_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> _Pointer   pointer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> _Reference reference;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>value_type 是指迭代器所指对象的型别，任何一个打算与 STL 算法有完美搭配的 class，都应该定义自己的 value type 内嵌型别；</p>
<p>difference_type 用来表示两个迭代器之间的距离，因此它可以用来表示一个容量的最大容量，对于连续空间的容器而言，头尾之间的距离就是其最大容量。</p>
<p>reference ，从迭代器所指之物的内容是否允许改变的角度来看，可分为 “所指对象之内容不可改变” 和 “所指对象之内容可改变”。其中后者可作为左值，在C++中，函数如果要传回左值，都是以 by reference 的方式进行。</p>
<p>iterator_category（迭代器类型，本文重点讨论对象，包括后面的 iterator_traits 也主要讨论这个）可分为以下五类：</p>
<p>   input iterator：这种迭代器所指的对象，不允许外界改变，只读型，只能一次一个向前读取元素（不支持 operator–），按此顺序一个个传回元素值。</p>
<p>   output iterator：唯写型，与 input iterator 相反，其作用是向前将元素值一个个写入（不支持 operator–），只能一个元素一个元素地赋新值。</p>
<p>   forward iterator：允许 “写入型” 算法在此种迭代器所形成的区间上进行一个个读写操作（不支持 operator–）。</p>
<p>   bidirectional iterator：可双向一个个移动（支持 operator–），某些算法需要逆向走访某个迭代器区间（如 copy_back() ）。</p>
<p>   random access iterator：随机存取迭代器，涵盖所有指针算数能力，包括 p+n，p-n，p[n]，p1-p2，p1&lt;p2。</p>
<p>给出一例代码，针对某种迭代器提供定义，以便在不同情况下提供最大效率。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">InputIter</span>, <span class="title">class</span> _<span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> __<span class="title">advance</span>(_<span class="title">InputIter</span>&amp; __<span class="title">i</span>, _<span class="title">Distance</span> __<span class="title">n</span>/*, <span class="title">input_iterator_tag</span>*/)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (__n--) ++__i;     <span class="comment">//单步前进</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//时间复杂度 O(N)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">BidirectionalIterator</span>, <span class="title">class</span> _<span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> __<span class="title">advance</span>(_<span class="title">BidirectionalIterator</span>&amp; __<span class="title">i</span>, _<span class="title">Distance</span> __<span class="title">n</span>/*, <span class="title">bidirectional_iterator_tag</span>*/)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (__n &gt;= <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (__n--) ++__i;   <span class="comment">//可进（单步）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (__n++) --__i;   <span class="comment">//可退（单步）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//时间复杂度 O(N)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">RandomAccessIterator</span>, <span class="title">class</span> _<span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> __<span class="title">advance</span>(_<span class="title">RandomAccessIterator</span>&amp; __<span class="title">i</span>, _<span class="title">Distance</span> __<span class="title">n</span>/*, <span class="title">random_access_iterator_tag</span>*/) </span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	__i += __n;   <span class="comment">//双向跳跃前进</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//时间复杂度 O(1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果 _RandomAccessIterator 型别的选择第二个函数调用，无疑增大了时间复杂度，效率下降。所以需要在编译期就选择正确的版本，重载函数机制可以达成这个目标。由于这三个函数的型别未定（因为都是 template 参数），为了形成重载函数，我们必须加上一个型别已确定的函数参数，使函数重载机制得以有效运作起来。</p>
<p>于是 SGI STL 采用了 traits 编程技法，其实质就是 traits 依靠显示模板特殊化来把代码中因类型不同而发生变化的片段拖出来，用统一的接口来包装。traits 有能力通过模板特殊化来萃取出迭代器的种类，我们可以利用这个 “迭代器类型” 相应型别作为 __advance() 的第三个参数，这个相应型别必须为一个 class type。因为编译器需依赖它来进行重载决议。</p>
<p>回顾前面的 __advance() 函数，加上第三个参数形成重载。另外没有针对 forward_iterator 而设计的版本，因为那和针对 input_iterator 而设计的版本完全一致。如果硬要设计一个那就是：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*下面这个函数定义并不存在*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">ForwardIterator</span>, <span class="title">class</span> _<span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> __<span class="title">advance</span>(_<span class="title">ForwardIterator</span>&amp; __<span class="title">i</span>, _<span class="title">Distance</span> __<span class="title">n</span>, <span class="title">forward_iterator_tag</span>) </span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	advance(__i, __n, input_iterator_tag);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//额外贴上 advance() 代码</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">InputIterator</span>, <span class="title">class</span> _<span class="title">Distance</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">void</span> <span class="title">advance</span>(_<span class="title">InputIterator</span>&amp; __<span class="title">i</span>, _<span class="title">Distance</span> __<span class="title">n</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	__advance(__i, __n, iterator_category(__i));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的 advance() 其 template 型别参数之所以命名为 _InputIterator，是为了遵循 STL 算法的命名规则：以算法所能接受之最初级类型来为其迭代器型别参数命名。要理解这里说的最初级类型。也就是说 advance() 并没有指定是 _InputIterator 类型，当客端调用 advance() 并使用 outputIterator 或 forwardIterator 或 BidirectionalIterator 时（迭代器类型之间存在着继承关系），统统都会传递调用 inputIterator 版的那个 __advance() 函数。</p>
<p>相信大家都看到了，上面的 advance() 函数接口只有两个参数，当它转调用 __advance() 时，才自行加上第三参数：迭代器类型。因此，这个函数（advance()）必须有能力从它所获得的迭代器中推导出其类型。这个工作交由 traits 机制处理，我们现在转到第三个参数 iterator_category()。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Iter</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">typename</span> <span class="title">iterator_traits</span>&lt;_Iter&gt;:</span>:iterator_category</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iterator_category(<span class="keyword">const</span> _Iter&amp; __i) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> __iterator_category(__i);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Iter</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">typename</span> <span class="title">iterator_traits</span>&lt;_Iter&gt;:</span>:iterator_category</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__iterator_category(<span class="keyword">const</span> _Iter&amp;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> iterator_traits&lt;_Iter&gt;::iterator_category _Category;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> _Category();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>整理后 __advance() 函数的原型就是这样</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__advance(__i, __n, iterator_traits&lt;_InputIterator&gt;::iterator_category());</span><br></pre></td></tr></table></figure>

<p>iterator_category() 函数被用来判定迭代器的类型，它的返回值是一个类对象，这个返回值取决于这个函数的参数型别，换句话说就是 iterator_category() 函数的返回值类型取决于它的参数类型，所以这个函数的参数类型必须是一个迭代器类型，现在这种机制已经被 iterator_traits 机制取代（iterator_traits 还添加了一开始介绍的几种 type）。</p>
<p>另外，还需要五个作为标记用的型别来代表五种迭代器类型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">input_iterator_tag</span> &#123;</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">output_iterator_tag</span> &#123;</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">forward_iterator_tag</span> :</span> <span class="keyword">public</span> input_iterator_tag &#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bidirectional_iterator_tag</span> :</span> <span class="keyword">public</span> forward_iterator_tag &#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">random_access_iterator_tag</span> :</span> <span class="keyword">public</span> bidirectional_iterator_tag &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>都为空，没有成员，只是单纯的定义为 “tag”，结合前面示例：如果 iterator_category() 的参数类型为 output iterator,那么他的返回值就是 output _ iterator_tag 类型的。 </p>
<p>下面贴出一份简单的代码来帮助理解：通过模板特化把类型不同的区分出来</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntType</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    IntType() :sum(<span class="number">0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetSum</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        sum += x;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"int type: "</span> &lt;&lt; sum &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> sum;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FloatType</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    FloatType() :sum(<span class="number">0.0f</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetSum</span><span class="params">(<span class="keyword">float</span> x)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        sum += x;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"float type: "</span> &lt;&lt; sum &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> sum;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义基本模板类，为空，无成员，只包含类型信息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Traits</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*模板特化，将输入类型定义成相同的名称，为编制模板类共同的调用接口做准备*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Traits</span>&lt;IntType&gt;  //特化定义的模板形参为 <span class="title">IntType</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">int</span> inputtype;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Traits</span>&lt;FloatType&gt;  //特化定义的模板形参为 <span class="title">FloatType</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">float</span> inputtype;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//公共接口</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typename</span> <span class="keyword">typedef</span> Traits&lt;T&gt;::inputtype input;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetSum</span><span class="params">(T&amp; t, input x)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        t.GetSum(x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    IntType intt;             <span class="comment">//类实例化</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    FloatType floatt;         <span class="comment">//类实例化</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Test&lt;IntType&gt; t1;          </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Test&lt;FloatType&gt; t2;        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//公共接口</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    t1.GetSum(intt, <span class="number">3</span>);                <span class="comment">//output：  int type: 3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    t2.GetSum(floatt, <span class="number">3.2f</span>);           <span class="comment">//output：  float type: 3.2 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/27/STL%E5%85%B3%E8%81%94%E5%BC%8F%E5%AE%B9%E5%99%A8map%E5%92%8Cmultimap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/27/STL%E5%85%B3%E8%81%94%E5%BC%8F%E5%AE%B9%E5%99%A8map%E5%92%8Cmultimap/" class="post-title-link" itemprop="url">STLset和multiset</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-27 15:35:08" itemprop="dateCreated datePublished" datetime="2020-12-27T15:35:08+08:00">2020-12-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-29 21:36:37" itemprop="dateModified" datetime="2020-12-29T21:36:37+08:00">2020-12-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>map与multimap的区别等同于set 与multiset的区别。</p>
<p>一、map</p>
<p>map的特性是，所有元素都会根据元素的键值自动被排序。map中的所有元素都是pair（意味着两个元素），同时拥有实质（value）和键值（key）。pair的第一元素被视为键值，第二元素被视为实质。回忆set，set 中的所有元素都是单个的（实值就是键值，键值就是实值）。map不允许两个元素拥有相同的键值。</p>
<p>下面是pair的定义</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>, <span class="title">class</span> <span class="title">T2</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">pair</span> &#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> T1 first_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> T2 second_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	T1 first;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	T2 second;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pair() : first(T1()), second(T2()) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pair(<span class="keyword">const</span> T1&amp; a, <span class="keyword">const</span> T2&amp; b) : first(a), second(b) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>从上可以看出，pair 包含两个类型（可以相同，也可以不相同）的公共元素。</p>
<p>map同set一样，都是关联式容器，内部元素的实值都会根据其键值来进行排序（set 的实值就是键值），所以都不能任意改变元素的键值，但是map可以任意改变元素的实值，我们所有操作的前提以及是否被允许，要看是否会影响到map元素的排序规则。</p>
<p>同样map和multimap 也是以RB-tree 为底层机制，几乎所有的map操作行为，都只是转调用RB-tree的操作行为而已。</p>
<p>set 和 map的内部结构即元素的存储都是RB-tree，set 中，RB-tree的节点内容是单一元素，而map中，节点内容则是一个pair（&lt;key，value&gt;）。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">map</span> &#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// typedefs:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> Key key_type; <span class="comment">//键值型别</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> T data_type;  <span class="comment">//实值型别</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> pair&lt;<span class="keyword">const</span> Key, T&gt; value_type;  <span class="comment">//元素性别（键值/实值）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> Compare key_compare;  <span class="comment">//键值比较函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//定义一个函数，其作用就是调用“元素比较函数”</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">value_compare</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">		:</span> <span class="keyword">public</span> binary_function&lt;value_type, value_type, <span class="keyword">bool</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">map</span>&lt;Key, T, Compare, Alloc&gt;;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		Compare comp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		value_compare(Compare c) : comp(c) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">//重载</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> value_type&amp; x, <span class="keyword">const</span> value_type&amp; y)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> comp(x.first, y.first);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rb_tree&lt;key_type, value_type,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		select1st&lt;value_type&gt;, key_compare, Alloc&gt; rep_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	rep_type t;  <span class="comment">// 以RB-tree为底层实现，所有元素(pair)存放在RB-tree节点中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//两种类型的都有，因为map允许用户通过迭代器修改元素的实值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::pointer pointer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::reference reference;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_reference const_reference;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::iterator iterator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_iterator const_iterator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::reverse_iterator reverse_iterator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_reverse_iterator const_reverse_iterator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::size_type size_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::difference_type difference_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// allocation/deallocation</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//构造函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">map</span>() : t(Compare()) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">explicit</span> <span class="title">map</span><span class="params">(<span class="keyword">const</span> Compare&amp; comp)</span> : <span class="title">t</span><span class="params">(comp)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*map一定使用底层RB-tree 的insert_unique()*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">map</span>(<span class="keyword">const</span> <span class="built_in">map</span>&lt;Key, T, Compare, Alloc&gt;&amp; x) : t(x.t) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">map</span>&lt;Key, T, Compare, Alloc&gt;&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> <span class="built_in">map</span>&lt;Key, T, Compare, Alloc&gt;&amp; x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t = x.t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// accessors:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//转调用RB-tree的操作行为</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">key_compare <span class="title">key_comp</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.key_comp(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">value_compare <span class="title">value_comp</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> value_compare(t.key_comp()); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> t.begin(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">const_iterator <span class="title">begin</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.begin(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> t.end(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">const_iterator <span class="title">end</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.end(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">reverse_iterator <span class="title">rbegin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> t.rbegin(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">const_reverse_iterator <span class="title">rbegin</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.rbegin(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">reverse_iterator <span class="title">rend</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> t.rend(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">const_reverse_iterator <span class="title">rend</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.rend(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.empty(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">size_type <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.size(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">size_type <span class="title">max_size</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.max_size(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*下面这个下标操作符重载函数是的map支持元素的直接存取，索引值是元素的key*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	T&amp; <span class="keyword">operator</span>[](<span class="keyword">const</span> key_type&amp; k) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> (*((insert(value_type(k, T()))).first)).second;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="built_in">map</span>&lt;Key, T, Compare, Alloc&gt;&amp; x)</span> </span>&#123; t.swap(x.t); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// insert/erase</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//都是调用底层RB-tree的操作行为</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pair&lt;iterator, bool&gt; insert(const value_type&amp; x) &#123; return t.insert_unique(x); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">insert</span><span class="params">(iterator position, <span class="keyword">const</span> value_type&amp; x)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.insert_unique(position, x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(iterator position)</span> </span>&#123; t.erase(position); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">size_type <span class="title">erase</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> </span>&#123; <span class="keyword">return</span> t.erase(x); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(iterator first, iterator last)</span> </span>&#123; t.erase(first, last); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123; t.clear(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// map operations:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*返回一个迭代器指向键值为key的元素，如果没找到就返回end()*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">find</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> </span>&#123; <span class="keyword">return</span> t.find(x); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">const_iterator <span class="title">find</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.find(x); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*返回键值等于key的元素的个数*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">size_type <span class="title">count</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.count(x); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*返回一个迭代器，指向键值&gt;=key的第一个元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">lower_bound</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> </span>&#123; <span class="keyword">return</span> t.lower_bound(x); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">const_iterator <span class="title">lower_bound</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.lower_bound(x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*返回一个迭代器，指向键值&gt;key的第一个元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">upper_bound</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> </span>&#123; <span class="keyword">return</span> t.upper_bound(x); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">const_iterator <span class="title">upper_bound</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.upper_bound(x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*返回键值为key的元素的第一个可安插位置和最后一个可安插位置，也就是“键值==key”的元素区间*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pair&lt;iterator, iterator&gt; equal_range(const key_type&amp; x) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.equal_range(x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pair&lt;const_iterator, const_iterator&gt; equal_range(const key_type&amp; x) const &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.equal_range(x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> <span class="built_in">map</span>&amp;, <span class="keyword">const</span> <span class="built_in">map</span>&amp;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> <span class="built_in">map</span>&amp;, <span class="keyword">const</span> <span class="built_in">map</span>&amp;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*运算符重载，几乎有所有的操作行为都是调用RB-tree的操作行为</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">事实上，包括set在内的关联式容器内部都是以RB-tree方式存放的*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Key</span>, <span class="title">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Compare</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">bool</span> <span class="title">operator</span>==(<span class="title">const</span> <span class="title">map</span>&lt;Key, T, Compare, Alloc&gt;&amp; <span class="title">x</span>,</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">	<span class="title">const</span> <span class="title">map</span>&lt;Key, T, Compare, Alloc&gt;&amp; <span class="title">y</span>) &#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> x.t == y.t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Key</span>, <span class="title">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Compare</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">bool</span> <span class="title">operator</span>&lt;(const map&lt;Key, T, Compare, Alloc&gt;&amp; x,</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">	const map&lt;Key, T, Compare, Alloc&gt;&amp; y) &#123;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">	return x.t &lt; y.t;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>

<p>通常，关联式容器并不提供元素的直接存取，你必须依靠迭代器，不过 map 内部的下标操作符重载函数使得其支持元素的直接存取，看看它是怎么实现的</p>
<p>这是map作为关联式容器特殊的地方（multimap没有哦）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*下面这个下标操作符重载函数是的map支持元素的直接存取，索引值是元素的key*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">T&amp; <span class="keyword">operator</span>[](<span class="keyword">const</span> key_type&amp; k) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (*((insert(value_type(k, T()))).first)).second;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*map中的元素，是一个由键值和实值组成的pair</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">value_type(k, T()) //typedef pair&lt;const Key, T&gt; value_type;产生一个与实值型别相同的暂时对象替代</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                   //就是产生一个键值为k，实值未知的对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">insert(value_type(k, T())) //将该元素插入到map里面，该操作返回一个pair，其第一个元素是个迭代器</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                           //指向插入妥当的新元素或指向插入失败点(键值重复)的旧元素</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*((insert(value_type(k, T()))).first) //先取插入操作所返回的pair的第一元素，即指向被插入元素的迭代器</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                                      //然后通过指针运算符提领该迭代器</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">(*((insert(value_type(k, T()))).first)).second //取其第二个元素，也就是实值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>操作 m[key] 返回一个 reference，指向键值为key 的元素的实值，如果该元素尚未存在，就安插该元素。map 是根据键值 key来排序的，实值不影响。</p>
<p>因为是返回一个 reference，可作为左值，并且是指向可修改的实值，所以同样可以利用下标操作符修改对应键值的实值。set 不具备的原因就是，其键值就是实值，不可修改。</p>
<p>二、multimap</p>
<p>同multiset类似，multimap 的特性以及用法几乎与map 完全相同，唯一的差别在于它允许键值重复，当然还有上面说到的这个直接存取，插入操作采用的是底层机制RB-tree 的 insert_equal()。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt; imap; <span class="comment">//以string 为键值，以int 为实值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*利用下标操作符，不存在的元素则安插（源码得知，内部调用insert()函数）*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	imap[<span class="built_in">string</span>(<span class="string">"qwer"</span>)] = <span class="number">1</span>; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	imap[<span class="built_in">string</span>(<span class="string">"tyui"</span>)] = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	imap[<span class="built_in">string</span>(<span class="string">"asdf"</span>)] = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	imap[<span class="built_in">string</span>(<span class="string">"ghjk"</span>)] = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pair&lt;string, int&gt; value(string("zxcv"), 5);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	imap.insert(value);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> number = imap[<span class="built_in">string</span>(<span class="string">"zxcv"</span>)];<span class="comment">//下标操作符获取元素的实值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; number &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	imap[<span class="built_in">string</span>(<span class="string">"zxcv"</span>)] = <span class="number">1</span>;<span class="comment">//左值运用</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	number = imap[<span class="built_in">string</span>(<span class="string">"zxcv"</span>)];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; number &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>关联式容器如set和map(multi..) 的erase操作，并没有返回值，不像序列式容器返回删除元素的下一个迭代器，所以一旦执行erase操作，如果不做处理极易发生危险。比如下面操作：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (pos = stocks.begin(); pos != stocks.end(); ++pos)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pos-&gt;second == value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		stocks.erase(pos);<span class="comment">//删除了pos。pos立马失效，++pos立即出错</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>map应用案例 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; </span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">double</span>&gt; StringDoubleMap;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	StringDoubleMap stocks;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*不知道是哪一年的股票价格*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	stocks[<span class="string">"BASF"</span>] = <span class="number">369.50</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	stocks[<span class="string">"VM"</span>] = <span class="number">413.50</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	stocks[<span class="string">"Daimler"</span>] = <span class="number">819.10</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	stocks[<span class="string">"BMW"</span>] = <span class="number">834.30</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	stocks[<span class="string">"Siemens"</span>] = <span class="number">842.20</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	StringDoubleMap::iterator pos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (pos = stocks.begin(); pos != stocks.end(); ++pos)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"stocks: "</span> &lt;&lt; pos-&gt;first &lt;&lt; <span class="string">"\t"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			&lt;&lt; <span class="string">"price: "</span> &lt;&lt; pos-&gt;second &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*移除迭代器所指元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">double</span> Express = <span class="number">0.000001</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (pos = stocks.begin(); pos != stocks.end();)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">abs</span>(pos-&gt;second - <span class="number">834.30</span>) &lt; Express)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			stocks.erase(pos++);<span class="comment">//这里是防止迭代器失效</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			++pos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (pos = stocks.begin(); pos != stocks.end(); ++pos)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"stocks: "</span> &lt;&lt; pos-&gt;first &lt;&lt; <span class="string">"\t"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			&lt;&lt; <span class="string">"price: "</span> &lt;&lt; pos-&gt;second &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/27/STL%E5%85%B3%E8%81%94%E5%BC%8F%E5%AE%B9%E5%99%A8set%E5%92%8Cmultiset/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KJH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/27/STL%E5%85%B3%E8%81%94%E5%BC%8F%E5%AE%B9%E5%99%A8set%E5%92%8Cmultiset/" class="post-title-link" itemprop="url">STLset和multiset</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-27 15:34:52" itemprop="dateCreated datePublished" datetime="2020-12-27T15:34:52+08:00">2020-12-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-29 21:36:02" itemprop="dateModified" datetime="2020-12-29T21:36:02+08:00">2020-12-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>标准的STL关联式容器分为set（集合）和map（映射表）两大类，以及两大类的衍生体multiset（多键集合）和multimap（多键映射表）（还有一些不在标准规格之列的关联式容器）。这些容器的底层机制均以<a href="http://blog.csdn.net/wenqian1991/article/details/26621657" target="_blank" rel="noopener">RB-tree（红黑树）</a>完成。</p>
<p>一、set</p>
<p>set 的特性是，所有元素都会根据元素的键值自动被排序，set 只拥有一个元素，它的键值就是实值，实值就是键值，并且set 不允许两个元素有相同的键值。</p>
<p>由于，set 元素值就是其键值，关系到 set 元素的排列规则，所以我们不能通过set 的迭代器来改变set 的元素值。标准的STL set 是以RB-tree 为底层机制，几乎所有的 set 操作行为，都只是转调用 RB-tree 的操作行为而已。</p>
<p>下面我们来看看 set 的源码（老版本）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">set</span> &#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// typedefs:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> Key key_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> Key value_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> Compare key_compare;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> Compare value_compare;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rb_tree&lt;key_type, value_type,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		identity&lt;value_type&gt;, key_compare, Alloc&gt; rep_type;    <span class="comment">//typedef RB-tree 类型</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	rep_type t;  <span class="comment">// 定义一棵红黑树t，也是set的唯一私有成员，set内部的元素皆存放于此</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*鉴于set特性，不允许修改其元素值，所以迭代器类型被定义为底层RB-tree的const_iterator*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_pointer pointer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_reference reference;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_reference const_reference;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_iterator iterator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_iterator const_iterator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_reverse_iterator reverse_iterator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::const_reverse_iterator const_reverse_iterator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::size_type size_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> rep_type::difference_type difference_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// allocation/deallocation</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*构造函数*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">set</span>() : t(Compare()) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">explicit</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> Compare&amp; comp)</span> : <span class="title">t</span><span class="params">(comp)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __STL_MEMBER_TEMPLATES</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">	<span class="title">set</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">		:</span> t(Compare()) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.insert_unique(first, last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">	<span class="title">set</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, <span class="title">const</span> <span class="title">Compare</span>&amp; <span class="title">comp</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">		:</span> t(comp) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.insert_unique(first, last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*将[first,end)之间的元素插入set中*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">set</span>(<span class="keyword">const</span> value_type* first, <span class="keyword">const</span> value_type* last)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		: t(Compare()) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.insert_unique(first, last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">set</span>(<span class="keyword">const</span> value_type* first, <span class="keyword">const</span> value_type* last, <span class="keyword">const</span> Compare&amp; comp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		: t(comp) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.insert_unique(first, last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">set</span>(const_iterator first, const_iterator last)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		: t(Compare()) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.insert_unique(first, last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">set</span>(const_iterator first, const_iterator last, <span class="keyword">const</span> Compare&amp; comp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		: t(comp) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.insert_unique(first, last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* __STL_MEMBER_TEMPLATES */</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//赋值运算符重载</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">set</span>(<span class="keyword">const</span> <span class="built_in">set</span>&lt;Key, Compare, Alloc&gt;&amp; x) : t(x.t) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">set</span>&lt;Key, Compare, Alloc&gt;&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> <span class="built_in">set</span>&lt;Key, Compare, Alloc&gt;&amp; x) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t = x.t; <span class="comment">//直接调用RB-tree的赋值操作函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// accessors:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*实值，键值都是同一元素值*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">key_compare <span class="title">key_comp</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.key_comp(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">value_compare <span class="title">value_comp</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.key_comp(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*下面的接口函数都是调用RB-tree的*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">begin</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.begin(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">end</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.end(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">reverse_iterator <span class="title">rbegin</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.rbegin(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">reverse_iterator <span class="title">rend</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.rend(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.empty(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">size_type <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.size(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">size_type <span class="title">max_size</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.max_size(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="built_in">set</span>&lt;Key, Compare, Alloc&gt;&amp; x)</span> </span>&#123; t.swap(x.t); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// insert/erase</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span>  pair&lt;iterator, <span class="keyword">bool</span>&gt; pair_iterator_bool;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*插入一个元素值，返回pair类型（分别是插入元素的迭代器和是否插入成功）*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pair&lt;iterator, bool&gt; insert(const value_type&amp; x) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">//RB-tree的insert_unique()返回一个pair类型</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		pair&lt;rep_type::iterator, <span class="keyword">bool</span>&gt; p = t.insert_unique(x);<span class="comment">//调用RB-tree的插入函数(自动排序)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> pair&lt;iterator, <span class="keyword">bool</span>&gt;(p.first, p.second);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*从position开始寻找一个可以插入值为x 的元素的位置将其插入并返回其迭代器*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//set(RB_tree)内部元素是自动排序，均不能在指定位置插入元素(或替换元素)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">insert</span><span class="params">(iterator position, <span class="keyword">const</span> value_type&amp; x)</span> </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.insert_unique((rep_type::iterator&amp;)position, x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __STL_MEMBER_TEMPLATES</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">	<span class="title">void</span> <span class="title">insert</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>) &#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.insert_unique(first, last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(const_iterator first, const_iterator last)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.insert_unique(first, last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> value_type* first, <span class="keyword">const</span> value_type* last)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.insert_unique(first, last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* __STL_MEMBER_TEMPLATES */</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*删除迭代器position所指元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(iterator position)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.erase((rep_type::iterator&amp;)position);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*删除key值为x的元素并返回被删除元素的个数*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">size_type <span class="title">erase</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.erase(x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*删除[first，end)之间的元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(iterator first, iterator last)</span> </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		t.erase((rep_type::iterator&amp;)first, (rep_type::iterator&amp;)last);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*清空容器*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123; t.clear(); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// set operations:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">find</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.find(x); &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">size_type <span class="title">count</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> t.count(x); &#125;<span class="comment">//统计元素值为 x的个数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*返回一个迭代器，指向键值&gt;=key的第一个元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">lower_bound</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.lower_bound(x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*返回一个迭代器，指向键值&gt;key的第一个元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function">iterator <span class="title">upper_bound</span><span class="params">(<span class="keyword">const</span> key_type&amp; x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.upper_bound(x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//查找键值等于x 的元素，返回pair</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pair&lt;iterator, iterator&gt; equal_range(const key_type&amp; x) const </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> t.equal_range(x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> <span class="built_in">set</span>&amp;, <span class="keyword">const</span> <span class="built_in">set</span>&amp;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> <span class="built_in">set</span>&amp;, <span class="keyword">const</span> <span class="built_in">set</span>&amp;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*调用RB-tree底层机制*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Key</span>, <span class="title">class</span> <span class="title">Compare</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">bool</span> <span class="title">operator</span>==(<span class="title">const</span> <span class="title">set</span>&lt;Key, Compare, Alloc&gt;&amp; <span class="title">x</span>,</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">	<span class="title">const</span> <span class="title">set</span>&lt;Key, Compare, Alloc&gt;&amp; <span class="title">y</span>) &#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> x.t == y.t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Key</span>, <span class="title">class</span> <span class="title">Compare</span>, <span class="title">class</span> <span class="title">Alloc</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">inline</span> <span class="title">bool</span> <span class="title">operator</span>&lt;(const set&lt;Key, Compare, Alloc&gt;&amp; x,</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">	const set&lt;Key, Compare, Alloc&gt;&amp; y) &#123;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">	return x.t &lt; y.t;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>





<p>set 包括下面将提到的multiset 其内部结构都是RB-tree，元素的存储以及相应操作都是引用Rb-tree的操作行为。set和multiset 内部元素都是自动排序的，这就意味着set和multiset 不提供用来直接存取元素的任何操作函数。另外对于迭代器而言，所有元素都被视为常数，这保证了不会人为的改变元素值，从而打乱既定排序。如果一定要改变元素值，必须先删除指定元素值，然后再重新插入新元素。</p>
<p>二、multiset</p>
<p>multiset 的特性以及用法和 set 完全相同，唯一的差别在于它允许键值重复，因此它的插入操作采用的是底层机制RB-tree 的insert_equal() 而非set 采用的 insert_unique()。</p>
<p>从上面的源代码可以看出，set 和 multiset 的操作函数都是转而去调用RB-tree的操作函数，其具体实现都在RB-tree中。</p>
<p>我们知道了set 和multiset 的内部结构是RB-tree（存储方式） ，有利于我们更好的把握这两个关联式容器的函数操作。</p>
<p>set 的 multiset 的区别</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> ia[] = &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt; <span class="title">iset</span><span class="params">(ia, ia + <span class="number">5</span>)</span></span>;<span class="comment">//set的构造函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt; <span class="title">imset</span><span class="params">(ia, ia + <span class="number">5</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"iset size = "</span> &lt;&lt; iset.size() &lt;&lt; <span class="built_in">endl</span>;<span class="comment">//iset size = 5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"iset 3 count = "</span> &lt;&lt; iset.count(<span class="number">3</span>) &lt;&lt; <span class="built_in">endl</span>;<span class="comment">//iset 3 count = 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	iset.insert(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"iset size = "</span> &lt;&lt; iset.size() &lt;&lt; <span class="built_in">endl</span>;<span class="comment">//iset size = 5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"iset 3 count = "</span> &lt;&lt; iset.count(<span class="number">3</span>) &lt;&lt; <span class="built_in">endl</span>;<span class="comment">//iset 3 count = 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    imset.insert(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"imset size = "</span> &lt;&lt; imset.size() &lt;&lt; <span class="built_in">endl</span>;<span class="comment">//imset size = 6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"imset 3 count = "</span> &lt;&lt; imset.count(<span class="number">3</span>) &lt;&lt; <span class="built_in">endl</span>;<span class="comment">//imset 3 count = 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*面对关联式容器，应该使用其所提供的find函数来搜寻元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt;::iterator iter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	iter = iset.find(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (iter != iset.end())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"3 found"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//*iter = 4; error，不能修改元素值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>multiset 应用案例：最小的k个数（适合海量数据处理）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; </span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> m, k;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> val;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; m &gt;&gt; k;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt; mset;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt;::iterator iter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; val;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (mset.size() &lt; k)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			mset.insert(val);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="comment">/*求最大的k个数，只需修改下面的迭代器和后面的if判断语句即可*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			iter = --mset.end();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (*iter &gt; val)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				mset.erase(*iter);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				mset.insert(val);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	iter = mset.begin();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; ++i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; *(iter++) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">KJH</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">168</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">KJH</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>

<span id="busuanzi_container_site_uv">
  本站总访问量<span id="busuanzi_value_site_uv"></span>次
</span>
        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
